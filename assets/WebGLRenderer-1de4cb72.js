import{M as j,E as d,w as g,T as p,a as Y,g as q,D as Ae,b as T,A as Be,R as ye}from"./CanvasTest-18dd6528.js";import{S as F,U as A,o as O,p as Z,q as Q,s as M,b as B,u as J,M as ee,B as y,v as xe,C as x,R as Ne,e as N,G as Ie,i as te,w as re,x as De,m as Ce,n as Ue}from"./SharedSystems-be3b2ea9.js";import{C as Ge}from"./CanvasSource-e2ba726f.js";import"./index-5b7226a9.js";import"./_commonjsHelpers-725317a4.js";class se{constructor(){this._didUpload=!1,this._tempState=F.for2d()}init(){const e=new A({tint:{value:new Float32Array([1,1,1,1]),type:"f32"},translationMatrix:{value:new j,type:"mat3x3<f32>"}}),r=O({name:"batch",bits:[Z,Q(ee),M]});this._shader=new B({glProgram:r,resources:{uniforms:e,batchSamplers:J}})}start(e,r){const s=e.renderer;s.shader.bind(this._shader,this._didUpload),s.shader.bindUniformBlock(s.globalUniforms.uniformGroup,"globalUniforms",0),s.geometry.bind(r,this._shader.glProgram)}execute(e,r){const s=e.renderer;this._didUpload=!0,this._tempState.blendMode=r.blendMode,s.state.set(this._tempState);const i=r.textures.textures;for(let n=0;n<i.length;n++)s.texture.bind(i[n],n);s.geometry.draw("triangle-list",r.size,r.start)}destroy(){this._shader.destroy(!0),this._shader=null}}se.extension={type:[d.WebGLPipesAdaptor],name:"batch"};var S=(t=>(t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t))(S||{});class Pe{constructor(e,r){this.buffer=e||null,this.updateID=-1,this.byteLength=-1,this.type=r}}class ie{constructor(e){this._gpuBuffers=Object.create(null),this._boundBufferBases=Object.create(null),this._renderer=e}destroy(){this.destroyAll(!0),this._renderer=null,this._gl=null,this._gpuBuffers=null,this._boundBufferBases=null}contextChange(){this.destroyAll(!0),this._gl=this._renderer.gl}getGlBuffer(e){return this._gpuBuffers[e.uid]||this.createGLBuffer(e)}bind(e){const{_gl:r}=this,s=this.getGlBuffer(e);r.bindBuffer(s.type,s.buffer)}bindBufferBase(e,r){const{_gl:s}=this;if(this._boundBufferBases[r]!==e){const i=this.getGlBuffer(e);this._boundBufferBases[r]=e,s.bindBufferBase(s.UNIFORM_BUFFER,r,i.buffer)}}bindBufferRange(e,r,s){const{_gl:i}=this;s=s||0;const n=this.getGlBuffer(e);i.bindBufferRange(i.UNIFORM_BUFFER,r||0,n.buffer,s*256,256)}updateBuffer(e){const{_gl:r}=this,s=this.getGlBuffer(e);if(e._updateID===s.updateID)return s;if(s.updateID=e._updateID,r.bindBuffer(s.type,s.buffer),s.byteLength>=e.data.byteLength)r.bufferSubData(s.type,0,e.data,0,e._updateSize/4);else{const i=e.descriptor.usage&y.STATIC?r.STATIC_DRAW:r.DYNAMIC_DRAW;s.byteLength=e.data.byteLength,r.bufferData(s.type,e.data,i)}return s}destroyAll(e){const r=this._gl;if(!e)for(const s in this._gpuBuffers)r.deleteBuffer(this._gpuBuffers[s].buffer);this._gpuBuffers={}}onBufferDestroy(e,r){const s=this._gpuBuffers[e.uid],i=this._gl;r||i.deleteBuffer(s.buffer),this._gpuBuffers[e.uid]=null}createGLBuffer(e){const{_gl:r}=this;let s=S.ARRAY_BUFFER;e.descriptor.usage&y.INDEX?s=S.ELEMENT_ARRAY_BUFFER:e.descriptor.usage&y.UNIFORM&&(s=S.UNIFORM_BUFFER);const i=new Pe(r.createBuffer(),s);return this._gpuBuffers[e.uid]=i,e.on("destroy",this.onBufferDestroy,this),i}}ie.extension={type:[d.WebGLSystem],name:"buffer"};class H{constructor(e){this._renderer=e,this.webGLVersion=2,this.extensions=Object.create(null),this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(e){this.gl=e,this._renderer.gl=e,e.isContextLost()&&e.getExtension("WEBGL_lose_context")&&e.getExtension("WEBGL_lose_context").restoreContext()}init(e){if(e?.context)this.initFromContext(e.context);else{const r=this._renderer.background.alpha<1,s=e.premultipliedAlpha??!0,i=e.antialias&&!this._renderer.backBuffer.useBackBuffer;this.initFromOptions({alpha:r,premultipliedAlpha:s,antialias:i,stencil:!0,preserveDrawingBuffer:e.preserveDrawingBuffer,powerPreference:e.powerPreference??"default"})}}initFromContext(e){this.gl=e,this.validateContext(e),this._renderer.runners.contextChange.emit(e);const r=this._renderer.view.canvas;r.addEventListener("webglcontextlost",this.handleContextLost,!1),r.addEventListener("webglcontextrestored",this.handleContextRestored,!1)}initFromOptions(e){const r=this.createContext(this._renderer.view.canvas,e);this.initFromContext(r)}createContext(e,r){const s=e.getContext("webgl2",r);return this.webGLVersion=2,this.gl=s,this.getExtensions(),this.gl}getExtensions(){const{gl:e}=this,r={anisotropicFiltering:e.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:e.getExtension("OES_texture_float_linear"),s3tc:e.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:e.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:e.getExtension("WEBGL_compressed_texture_etc"),etc1:e.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:e.getExtension("WEBGL_compressed_texture_atc"),astc:e.getExtension("WEBGL_compressed_texture_astc"),bptc:e.getExtension("EXT_texture_compression_bptc")};Object.assign(this.extensions,r,{colorBufferFloat:e.getExtension("EXT_color_buffer_float")})}handleContextLost(e){e.preventDefault()}handleContextRestored(){this._renderer.runners.contextChange.emit(this.gl)}destroy(){const e=this._renderer.view.canvas;this._renderer=null,e.removeEventListener("webglcontextlost",this.handleContextLost),e.removeEventListener("webglcontextrestored",this.handleContextRestored),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()}validateContext(e){const r=e.getContextAttributes(),s="WebGL2RenderingContext"in globalThis&&e instanceof globalThis.WebGL2RenderingContext;s&&(this.webGLVersion=2),r&&!r.stencil&&g("Provided WebGL context does not have a stencil buffer, masks may not render correctly");const i=s||!!e.getExtension("OES_element_index_uint");this.supports.uint32Indices=i,i||g("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")}}H.extension={type:[d.WebGLSystem],name:"context"};H.defaultOptions={context:null,premultipliedAlpha:!0,preserveDrawingBuffer:!1,powerPreference:void 0};var G=(t=>(t[t.RGBA=6408]="RGBA",t[t.RGB=6407]="RGB",t[t.RG=33319]="RG",t[t.RED=6403]="RED",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.ALPHA=6406]="ALPHA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t))(G||{}),ne=(t=>(t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t))(ne||{}),f=(t=>(t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.BYTE=5120]="BYTE",t[t.SHORT=5122]="SHORT",t[t.INT=5124]="INT",t[t.FLOAT=5126]="FLOAT",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t[t.HALF_FLOAT=36193]="HALF_FLOAT",t))(f||{});const k={uint8x2:{type:f.UNSIGNED_BYTE,size:2,normalised:!1},uint8x4:{type:f.UNSIGNED_BYTE,size:4,normalised:!1},sint8x2:{type:f.BYTE,size:2,normalised:!1},sint8x4:{type:f.BYTE,size:4,normalised:!1},unorm8x2:{type:f.UNSIGNED_BYTE,size:2,normalised:!0},unorm8x4:{type:f.UNSIGNED_BYTE,size:4,normalised:!0},snorm8x2:{type:f.BYTE,size:2,normalised:!0},snorm8x4:{type:f.BYTE,size:4,normalised:!0},uint16x2:{type:f.UNSIGNED_SHORT,size:2,normalised:!1},uint16x4:{type:f.UNSIGNED_SHORT,size:4,normalised:!1},sint16x2:{type:f.SHORT,size:2,normalised:!1},sint16x4:{type:f.SHORT,size:4,normalised:!1},unorm16x2:{type:f.UNSIGNED_SHORT,size:2,normalised:!0},unorm16x4:{type:f.UNSIGNED_SHORT,size:4,normalised:!0},snorm16x2:{type:f.SHORT,size:2,normalised:!0},snorm16x4:{type:f.SHORT,size:4,normalised:!0},float16x2:{type:f.HALF_FLOAT,size:2,normalised:!1},float16x4:{type:f.HALF_FLOAT,size:4,normalised:!1},float32:{type:f.FLOAT,size:1,normalised:!1},float32x2:{type:f.FLOAT,size:2,normalised:!1},float32x3:{type:f.FLOAT,size:3,normalised:!1},float32x4:{type:f.FLOAT,size:4,normalised:!1},uint32:{type:f.UNSIGNED_INT,size:1,normalised:!1},uint32x2:{type:f.UNSIGNED_INT,size:2,normalised:!1},uint32x3:{type:f.UNSIGNED_INT,size:3,normalised:!1},uint32x4:{type:f.UNSIGNED_INT,size:4,normalised:!1},sint32:{type:f.INT,size:1,normalised:!1},sint32x2:{type:f.INT,size:2,normalised:!1},sint32x3:{type:f.INT,size:3,normalised:!1},sint32x4:{type:f.INT,size:4,normalised:!1}};function Fe(t){return k[t]??k.float32}const I={5126:4,5123:2,5121:1},Oe={"point-list":0,"line-list":1,"line-strip":3,"triangle-list":4,"triangle-strip":5};class ae{constructor(e){this._geometryVaoHash={},this._renderer=e,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!0}contextChange(){this.gl=this._renderer.gl}bind(e,r){const s=this.gl;this._activeGeometry=e;const i=this.getVao(e,r);this._activeVao!==i&&(this._activeVao=i,s.bindVertexArray(i)),this.updateBuffers()}reset(){this.unbind()}updateBuffers(){const e=this._activeGeometry,r=this._renderer.buffer;for(let s=0;s<e.buffers.length;s++){const i=e.buffers[s];r.updateBuffer(i)}}checkCompatibility(e,r){const s=e.attributes,i=r._attributeData;for(const n in i)if(!s[n])throw new Error(`shader and geometry incompatible, geometry missing the "${n}" attribute`)}getSignature(e,r){const s=e.attributes,i=r._attributeData,n=["g",e.uid];for(const a in s)i[a]&&n.push(a,i[a].location);return n.join("-")}getVao(e,r){return this._geometryVaoHash[e.uid]?.[r._key]||this.initGeometryVao(e,r)}initGeometryVao(e,r,s=!0){const i=this._renderer.gl,n=this._renderer.buffer;this._renderer.shader._getProgramData(r),this.checkCompatibility(e,r);const a=this.getSignature(e,r);this._geometryVaoHash[e.uid]||(this._geometryVaoHash[e.uid]=Object.create(null),e.on("destroy",this.onGeometryDestroy,this));const o=this._geometryVaoHash[e.uid];let c=o[a];if(c)return o[r._key]=c,c;const u=e.buffers,l=e.attributes,_={},m={};for(const h in u)_[h]=0,m[h]=0;for(const h in l)!l[h].size&&r._attributeData[h]?l[h].size=r._attributeData[h].size:l[h].size||g(`PIXI Geometry attribute '${h}' size cannot be determined (likely the bound shader does not have the attribute)`),_[l[h].buffer.uid]+=l[h].size*I[l[h].type];for(const h in l){const E=l[h],w=E.size;E.stride===void 0&&(_[E.buffer.uid]===w*I[E.type]?E.stride=0:E.stride=_[E.buffer.uid]),E.start===void 0&&(E.start=m[E.buffer.uid],m[E.buffer.uid]+=w*I[E.type])}c=i.createVertexArray(),i.bindVertexArray(c);for(let h=0;h<u.length;h++){const E=u[h];n.bind(E)}return this.activateVao(e,r),o[r._key]=c,o[a]=c,i.bindVertexArray(null),c}onGeometryDestroy(e,r){const s=this._geometryVaoHash[e.uid],i=this.gl;if(s){if(r)for(const n in s)this._activeVao!==s[n]&&this.unbind(),i.deleteVertexArray(s[n]);this._geometryVaoHash[e.uid]=null}}destroyAll(e=!1){const r=this.gl;for(const s in this._geometryVaoHash){if(e)for(const i in this._geometryVaoHash[s]){const n=this._geometryVaoHash[s];this._activeVao!==n&&this.unbind(),r.deleteVertexArray(n[i])}this._geometryVaoHash[s]=null}}activateVao(e,r){const s=this._renderer.gl,i=this._renderer.buffer,n=e.attributes;e.indexBuffer&&i.bind(e.indexBuffer);let a=null;for(const o in n){const c=n[o],u=c.buffer,l=i.getGlBuffer(u);if(r._attributeData[o]){a!==l&&(i.bind(u),a=l);const _=r._attributeData[o].location;s.enableVertexAttribArray(_);const m=Fe(c.format);if(s.vertexAttribPointer(_,m.size,m.type,m.normalised,c.stride,c.offset),c.instance)if(this.hasInstance)s.vertexAttribDivisor(_,1);else throw new Error("geometry error, GPU Instancing is not supported on this device")}}}draw(e,r,s,i){const{gl:n}=this._renderer,a=this._activeGeometry,o=Oe[a.topology||e];if(a.indexBuffer){const c=a.indexBuffer.data.BYTES_PER_ELEMENT,u=c===2?n.UNSIGNED_SHORT:n.UNSIGNED_INT;a.instanced?n.drawElementsInstanced(o,r||a.indexBuffer.data.length,u,(s||0)*c,a.instanceCount||1):n.drawElements(o,r||a.indexBuffer.data.length,u,(s||0)*c)}else a.instanced?n.drawArraysInstanced(o,s,r||a.getSize(),i||1):n.drawArrays(o,s,r||a.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this._renderer=null,this.gl=null,this._activeVao=null,this._activeGeometry=null}}ae.extension={type:[d.WebGLSystem],name:"geometry"};const Me=new xe({vertex:`
        out vec2 vUv;

        void main() {
            vUv = vec2((gl_VertexID << 1) & 2, (gl_VertexID & 2));

            gl_Position = vec4(vUv * 2.0f + -1.0f, 0.0f, 1.0f);

            // flip dem UVs
            vUv.y = 1.0f - vUv.y;
        }`,fragment:`
        in vec2 vUv;
        out vec4 fragColor;

        uniform sampler2D uTexture;

        void main() {
            fragColor = texture(uTexture, vUv);
        }`,name:"big-triangle"}),V=new B({glProgram:Me,resources:{uTexture:p.WHITE.source}}),oe=class{constructor(t){this.useBackBuffer=!1,this._useBackBufferThisRender=!1,this._renderer=t}init(t={}){const{useBackBuffer:e,antialias:r}={...oe.defaultOptions,...t};this.useBackBuffer=e,this._antialias=r}renderStart(t){const e=this._renderer.renderTarget.getRenderTarget(t.target);if(this._useBackBufferThisRender=this.useBackBuffer&&!!e.isRoot,this._useBackBufferThisRender){const r=this._renderer.renderTarget.getRenderTarget(t.target);this._targetTexture=r.colorTexture,t.target=this._getBackBufferTexture(r.colorTexture)}}renderEnd(){this._presentBackBuffer()}_presentBackBuffer(){const t=this._renderer;if(t.renderTarget.finishRenderPass(),!this._useBackBufferThisRender)return;const e=t.gl;t.renderTarget.bind(this._targetTexture,!1),V.resources.uTexture=this._backBufferTexture.source,t.shader.bind(V,!1),t.state.set(F.for2d()),e.drawArrays(e.TRIANGLES,0,3)}_getBackBufferTexture(t){return this._backBufferTexture=this._backBufferTexture||new p({source:new Y({width:t.width,height:t.height,resolution:t._resolution,antialias:this._antialias})}),this._backBufferTexture.source.resize(t.width,t.height,t._resolution),this._backBufferTexture}destroy(){this._backBufferTexture&&(this._backBufferTexture.destroy(),this._backBufferTexture=null)}};let L=oe;L.extension={type:[d.WebGLSystem],name:"backBuffer",priority:1};L.defaultOptions={useBackBuffer:!1};class ce{constructor(e){this._colorMaskCache=15,this._renderer=e}setMask(e){this._colorMaskCache!==e&&(this._colorMaskCache=e,this._renderer.gl.colorMask(!!(e&8),!!(e&4),!!(e&2),!!(e&1)))}}ce.extension={type:[d.WebGLSystem],name:"colorMask"};class ue{constructor(e){this.commandFinished=Promise.resolve(),this._renderer=e}setGeometry(e,r){this._renderer.geometry.bind(e,r.glProgram)}finishRenderPass(){}draw(e){const r=this._renderer,{geometry:s,shader:i,state:n,skipSync:a,topology:o,size:c,start:u,instanceCount:l}=e;r.shader.bind(i,a),r.geometry.bind(s,r.shader._activeProgram),n&&r.state.set(n),r.geometry.draw(o,c,u,l)}destroy(){this._renderer=null}}ue.extension={type:[d.WebGLSystem],name:"encoder"};class He{constructor(){this.width=-1,this.height=-1,this.msaa=!1,this.msaaRenderBuffer=[]}}class Le{constructor(){this._clearColorCache=[0,0,0,0],this._viewPortCache=new q}init(e,r){this._renderer=e,this._renderTargetSystem=r}copyToTexture(e,r,s,i){const n=this._renderTargetSystem,a=this._renderer,o=n.getGpuRenderTarget(e),c=a.gl;return this.finishRenderPass(e),c.bindFramebuffer(c.FRAMEBUFFER,o.resolveTargetFramebuffer),a.texture.bind(r,0),c.copyTexSubImage2D(c.TEXTURE_2D,0,0,0,s.x,s.y,i.width,i.height),r}startRenderPass(e,r=!0,s,i){const n=this._renderTargetSystem,a=e.colorTexture,o=n.getGpuRenderTarget(e);let c=i.y;e.isRoot&&(c=a.pixelHeight-i.height),e.colorTextures.forEach(_=>{this._renderer.texture.unbind(_)});const u=this._renderer.gl;u.bindFramebuffer(u.FRAMEBUFFER,o.framebuffer);const l=this._viewPortCache;(l.x!==i.x||l.y!==c||l.width!==i.width||l.height!==i.height)&&(l.x=i.x,l.y=c,l.width=i.width,l.height=i.height,u.viewport(i.x,c,i.width,i.height)),this.clear(e,r,s)}finishRenderPass(e){const s=this._renderTargetSystem.getGpuRenderTarget(e);if(!s.msaa)return;const i=this._renderer.gl;i.bindFramebuffer(i.FRAMEBUFFER,s.resolveTargetFramebuffer),i.bindFramebuffer(i.READ_FRAMEBUFFER,s.framebuffer),i.blitFramebuffer(0,0,s.width,s.height,0,0,s.width,s.height,i.COLOR_BUFFER_BIT,i.NEAREST),i.bindFramebuffer(i.FRAMEBUFFER,s.framebuffer)}initGpuRenderTarget(e){const s=this._renderer.gl,i=new He;return Ge.test(e.colorTexture.resource)?(i.framebuffer=null,i):(this._initColor(e,i),e.stencil&&this._initStencil(i),s.bindFramebuffer(s.FRAMEBUFFER,null),i)}clear(e,r,s){if(!r)return;const i=this._renderTargetSystem;typeof r=="boolean"&&(r=r?x.ALL:x.NONE);const n=this._renderer.gl;if(r&x.COLOR){s??(s=i.defaultClearColor);const a=this._clearColorCache,o=s;(a[0]!==o[0]||a[1]!==o[1]||a[2]!==o[2]||a[3]!==o[3])&&(a[0]=o[0],a[1]=o[1],a[2]=o[2],a[3]=o[3],n.clearColor(o[0],o[1],o[2],o[3]))}n.clear(r)}resizeGpuRenderTarget(e){if(e.isRoot)return;const s=this._renderTargetSystem.getGpuRenderTarget(e);this._resizeColor(e,s),e.stencil&&this._resizeStencil(s)}_initColor(e,r){const s=this._renderer,i=s.gl,n=i.createFramebuffer();if(r.resolveTargetFramebuffer=n,i.bindFramebuffer(i.FRAMEBUFFER,n),r.width=e.colorTexture.source.pixelWidth,r.height=e.colorTexture.source.pixelHeight,e.colorTextures.forEach((a,o)=>{const c=a.source;c.antialias&&(r.msaa=!0),s.texture.bindSource(c,0);const l=s.texture.getGlSource(c).texture;i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+o,3553,l,0)}),r.msaa){const a=i.createFramebuffer();r.framebuffer=a,i.bindFramebuffer(i.FRAMEBUFFER,a),e.colorTextures.forEach((o,c)=>{const u=i.createRenderbuffer();r.msaaRenderBuffer[c]=u})}else r.framebuffer=n;this._resizeColor(e,r)}_resizeColor(e,r){const s=e.colorTexture.source;if(r.width=s.pixelWidth,r.height=s.pixelHeight,e.colorTextures.forEach((i,n)=>{n!==0&&i.source.resize(s.width,s.height,s._resolution)}),r.msaa){const i=this._renderer,n=i.gl,a=r.framebuffer;n.bindFramebuffer(n.FRAMEBUFFER,a),e.colorTextures.forEach((o,c)=>{const u=o.source;i.texture.bindSource(u,0);const _=i.texture.getGlSource(u).internalFormat,m=r.msaaRenderBuffer[c];n.bindRenderbuffer(n.RENDERBUFFER,m),n.renderbufferStorageMultisample(n.RENDERBUFFER,4,_,u.pixelWidth,u.pixelHeight),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+c,n.RENDERBUFFER,m)})}}_initStencil(e){const r=this._renderer.gl,s=r.createRenderbuffer();e.depthStencilRenderBuffer=s,r.bindRenderbuffer(r.RENDERBUFFER,s),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.RENDERBUFFER,s),this._resizeStencil(e)}_resizeStencil(e){const r=this._renderer.gl;r.bindRenderbuffer(r.RENDERBUFFER,e.depthStencilRenderBuffer),e.msaa?r.renderbufferStorageMultisample(r.RENDERBUFFER,4,r.DEPTH24_STENCIL8,e.width,e.height):r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH24_STENCIL8,e.width,e.height)}}class le extends Ne{constructor(e){super(e),this.adaptor=new Le,this.adaptor.init(e,this)}}le.extension={type:[d.WebGLSystem],name:"renderTarget"};class fe{constructor(e){this._stencilCache={enabled:!1,stencilReference:0,stencilMode:N.NONE},this._renderTargetStencilState=Object.create(null),e.renderTarget.onRenderTargetChange.add(this)}contextChange(e){this._gl=e,this._comparisonFuncMapping={always:e.ALWAYS,never:e.NEVER,equal:e.EQUAL,"not-equal":e.NOTEQUAL,less:e.LESS,"less-equal":e.LEQUAL,greater:e.GREATER,"greater-equal":e.GEQUAL},this._stencilOpsMapping={keep:e.KEEP,zero:e.ZERO,replace:e.REPLACE,invert:e.INVERT,"increment-clamp":e.INCR,"decrement-clamp":e.DECR,"increment-wrap":e.INCR_WRAP,"decrement-wrap":e.DECR_WRAP}}onRenderTargetChange(e){if(this._activeRenderTarget===e)return;this._activeRenderTarget=e;let r=this._renderTargetStencilState[e.uid];r||(r=this._renderTargetStencilState[e.uid]={stencilMode:N.DISABLED,stencilReference:0}),this.setStencilMode(r.stencilMode,r.stencilReference)}setStencilMode(e,r){const s=this._renderTargetStencilState[this._activeRenderTarget.uid],i=this._gl,n=Ie[e],a=this._stencilCache;if(s.stencilMode=e,s.stencilReference=r,e===N.DISABLED){this._stencilCache.enabled&&(this._stencilCache.enabled=!1,i.disable(i.STENCIL_TEST));return}this._stencilCache.enabled||(this._stencilCache.enabled=!0,i.enable(i.STENCIL_TEST)),(e!==a.stencilMode||a.stencilReference!==r)&&(a.stencilMode=e,a.stencilReference=r,i.stencilFunc(this._comparisonFuncMapping[n.stencilBack.compare],r,255),i.stencilOp(i.KEEP,i.KEEP,this._stencilOpsMapping[n.stencilBack.passOp]))}}fe.extension={type:[d.WebGLSystem],name:"stencil"};class we{constructor(e,r){this.program=e,this.uniformData=r,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBlockBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBlockBindings=null,this.program=null}}function X(t,e,r){const s=t.createShader(e);return t.shaderSource(s,r),t.compileShader(s),s}function D(t){const e=new Array(t);for(let r=0;r<e.length;r++)e[r]=!1;return e}function _e(t,e){switch(t){case"float":return 0;case"vec2":return new Float32Array(2*e);case"vec3":return new Float32Array(3*e);case"vec4":return new Float32Array(4*e);case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*e);case"ivec3":return new Int32Array(3*e);case"ivec4":return new Int32Array(4*e);case"uvec2":return new Uint32Array(2*e);case"uvec3":return new Uint32Array(3*e);case"uvec4":return new Uint32Array(4*e);case"bool":return!1;case"bvec2":return D(2*e);case"bvec3":return D(3*e);case"bvec4":return D(4*e);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}const ke={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function Ve(t){return ke[t]}let R=null;const W={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function he(t,e){if(!R){const r=Object.keys(W);R={};for(let s=0;s<r.length;++s){const i=r[s];R[t[i]]=W[i]}}return R[e]}function Xe(t,e){const r={},s=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let i=0;i<s;i++){const n=e.getActiveAttrib(t,i);if(n.name.startsWith("gl_"))continue;const a=he(e,n.type),o={type:a,name:n.name,size:Ve(a),location:e.getAttribLocation(t,n.name)};r[n.name]=o}return r}function We(t,e){const r={},s=e.getProgramParameter(t,e.ACTIVE_UNIFORM_BLOCKS);for(let i=0;i<s;i++){const n=e.getActiveUniformBlockName(t,i),a=e.getUniformBlockIndex(t,n),o=e.getActiveUniformBlockParameter(t,i,e.UNIFORM_BLOCK_DATA_SIZE);r[n]={name:n,index:a,size:o}}return r}function ze(t,e){const r={},s=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let i=0;i<s;i++){const n=e.getActiveUniform(t,i),a=n.name.replace(/\[.*?\]$/,""),o=!!n.name.match(/\[.*?\]$/),c=he(e,n.type);r[a]={name:a,index:i,type:c,size:n.size,isArray:o,value:_e(c,n.size)}}return r}function z(t,e){const r=t.getShaderSource(e).split(`
`).map((u,l)=>`${l}: ${u}`),s=t.getShaderInfoLog(e),i=s.split(`
`),n={},a=i.map(u=>parseFloat(u.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"))).filter(u=>u&&!n[u]?(n[u]=!0,!0):!1),o=[""];a.forEach(u=>{r[u-1]=`%c${r[u-1]}%c`,o.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")});const c=r.join(`
`);o[0]=c,console.error(s),console.groupCollapsed("click to view full shader code"),console.warn(...o),console.groupEnd()}function $e(t,e,r,s){t.getProgramParameter(e,t.LINK_STATUS)||(t.getShaderParameter(r,t.COMPILE_STATUS)||z(t,r),t.getShaderParameter(s,t.COMPILE_STATUS)||z(t,s),console.error("PixiJS Error: Could not initialize shader."),t.getProgramInfoLog(e)!==""&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",t.getProgramInfoLog(e)))}function Ke(t,e){const r=X(t,t.VERTEX_SHADER,e.vertex),s=X(t,t.FRAGMENT_SHADER,e.fragment),i=t.createProgram();t.attachShader(i,r),t.attachShader(i,s);const n=e.transformFeedbackVaryings;n&&(typeof t.transformFeedbackVaryings!="function"?g("TransformFeedback is not supported but TransformFeedbackVaryings are given."):t.transformFeedbackVaryings(i,n.names,n.bufferMode==="separate"?t.SEPARATE_ATTRIBS:t.INTERLEAVED_ATTRIBS)),t.linkProgram(i),t.getProgramParameter(i,t.LINK_STATUS)||$e(t,i,r,s),e._attributeData=Xe(i,t),e._uniformData=ze(i,t),e._uniformBlockData=We(i,t),t.deleteShader(r),t.deleteShader(s);const a={};for(const c in e._uniformData){const u=e._uniformData[c];a[c]={location:t.getUniformLocation(i,c),value:_e(u.type,u.size)}}return new we(i,a)}const v={textureCount:0,blockIndex:0};class de{constructor(e){this._activeProgram=null,this._programDataHash=Object.create(null),this._nextIndex=0,this._boundUniformsIdsToIndexHash=Object.create(null),this._boundIndexToUniformsHash=Object.create(null),this._renderer=e}contextChange(e){this._gl=e,this._maxBindings=e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS)}bind(e,r){if(this._setProgram(e.glProgram),r)return;v.textureCount=0,v.blockIndex=0;const s=this._gl,i=this._getProgramData(e.glProgram);for(const n in e.groups){const a=e.groups[n];for(const o in a.resources){const c=a.resources[o];if(c instanceof A)c.ubo?this.bindUniformBlock(c,e._uniformBindMap[n][o],v.blockIndex++):this._updateUniformGroup(c);else if(c instanceof te)this.bindUniformBlock(c,e._uniformBindMap[n][o],v.blockIndex++);else if(c instanceof Y){this._renderer.texture.bind(c,v.textureCount);const u=e._uniformBindMap[n][o],l=i.uniformData[u];l&&(l.value!==v.textureCount&&s.uniform1i(l.location,v.textureCount),v.textureCount++)}}}}_updateUniformGroup(e){this._renderer.uniformGroup.updateUniformGroup(e,this._activeProgram,v)}bindUniformBlock(e,r,s=0){const i=this._renderer.buffer,n=this._getProgramData(this._activeProgram),a=e._bufferResource;a&&this._renderer.uniformBuffer.updateUniformGroup(e),i.updateBuffer(e.buffer);let o=this._boundUniformsIdsToIndexHash[e.uid];if(o===void 0){const l=this._nextIndex++%this._maxBindings,_=this._boundIndexToUniformsHash[l];_&&(this._boundUniformsIdsToIndexHash[_.uid]=void 0),o=this._boundUniformsIdsToIndexHash[e.uid]=l,this._boundIndexToUniformsHash[l]=e,a?i.bindBufferRange(e.buffer,l,e.offset):i.bindBufferBase(e.buffer,l)}const c=this._gl,u=this._activeProgram._uniformBlockData[r].index;n.uniformBlockBindings[s]!==o&&(n.uniformBlockBindings[s]=o,c.uniformBlockBinding(n.program,u,o))}_setProgram(e){if(this._activeProgram===e)return;this._activeProgram=e;const r=this._getProgramData(e);this._gl.useProgram(r.program)}_getProgramData(e){return this._programDataHash[e._key]||this._createProgramData(e)}_createProgramData(e){const r=e._key;return this._programDataHash[r]=Ke(this._gl,e),this._programDataHash[r]}destroy(){for(const e of Object.keys(this._programDataHash))this._programDataHash[e].destroy(),this._programDataHash[e]=null;this._programDataHash=null,this._boundUniformsIdsToIndexHash=null}}de.extension={type:[d.WebGLSystem],name:"shader"};let b;function je(){if(typeof b=="boolean")return b;try{b=new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")===!0}catch{b=!1}return b}const C=[{test:t=>t.type==="float"&&t.size===1&&!t.isArray,code:t=>`
            if(uv["${t}"] !== ud["${t}"].value)
            {
                ud["${t}"].value = uv["${t}"]
                gl.uniform1f(ud["${t}"].location, uv["${t}"])
            }
            `},{test:(t,e)=>(t.type==="sampler2D"||t.type==="samplerCube"||t.type==="sampler2DArray")&&t.size===1&&!t.isArray&&(e==null||e instanceof p),code:t=>`t = syncData.textureCount++;

            renderer.texture.bind(uv["${t}"], t);

            if(ud["${t}"].value !== t)
            {
                ud["${t}"].value = t;
                gl.uniform1i(ud["${t}"].location, t);
; // eslint-disable-line max-len
            }`},{test:(t,e)=>t.type==="mat3"&&t.size===1&&!t.isArray&&e.a!==void 0,code:t=>`
            gl.uniformMatrix3fv(ud["${t}"].location, false, uv["${t}"].toArray(true));
            `},{test:(t,e)=>t.type==="vec2"&&t.size===1&&!t.isArray&&e.x!==void 0,code:t=>`
                cv = ud["${t}"].value;
                v = uv["${t}"];

                if(cv[0] !== v.x || cv[1] !== v.y)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    gl.uniform2f(ud["${t}"].location, v.x, v.y);
                }`},{test:t=>t.type==="vec2"&&t.size===1&&!t.isArray,code:t=>`
                cv = ud["${t}"].value;
                v = uv["${t}"];

                if(cv[0] !== v[0] || cv[1] !== v[1])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    gl.uniform2f(ud["${t}"].location, v[0], v[1]);
                }
            `},{test:(t,e)=>t.type==="vec4"&&t.size===1&&!t.isArray&&e.width!==void 0,code:t=>`
                cv = ud["${t}"].value;
                v = uv["${t}"];

                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    cv[2] = v.width;
                    cv[3] = v.height;
                    gl.uniform4f(ud["${t}"].location, v.x, v.y, v.width, v.height)
                }`},{test:(t,e)=>t.type==="vec4"&&t.size===1&&!t.isArray&&e.red!==void 0,code:t=>`
                cv = ud["${t}"].value;
                v = uv["${t}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.alpha)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;
                    cv[3] = v.alpha;
                    gl.uniform4f(ud["${t}"].location, v.red, v.green, v.blue, v.alpha)
                }`},{test:(t,e)=>t.type==="vec3"&&t.size===1&&!t.isArray&&e.red!==void 0,code:t=>`
                cv = ud["${t}"].value;
                v = uv["${t}"];

                if(cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.a)
                {
                    cv[0] = v.red;
                    cv[1] = v.green;
                    cv[2] = v.blue;

                    gl.uniform3f(ud["${t}"].location, v.red, v.green, v.blue)
                }`},{test:t=>t.type==="vec4"&&t.size===1&&!t.isArray,code:t=>`
                cv = ud["${t}"].value;
                v = uv["${t}"];

                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    cv[2] = v[2];
                    cv[3] = v[3];

                    gl.uniform4f(ud["${t}"].location, v[0], v[1], v[2], v[3])
                }`}],Ye={float:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1f(location, v);
    }`,vec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2f(location, v[0], v[1])
    }`,vec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3f(location, v[0], v[1], v[2])
    }`,vec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4f(location, v[0], v[1], v[2], v[3]);
    }`,int:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,ivec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,ivec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,ivec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,uint:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1ui(location, v);
    }`,uvec2:`
    if (cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2ui(location, v[0], v[1]);
    }`,uvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3ui(location, v[0], v[1], v[2]);
    }`,uvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);
    }`,bool:`
    if (cv !== v)
    {
        cu.value = v;
        gl.uniform1i(location, v);
    }`,bvec2:`
    if (cv[0] != v[0] || cv[1] != v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];

        gl.uniform2i(location, v[0], v[1]);
    }`,bvec3:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3i(location, v[0], v[1], v[2]);
    }`,bvec4:`
    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];
        cv[3] = v[3];

        gl.uniform4i(location, v[0], v[1], v[2], v[3]);
    }`,mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,samplerCube:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`,sampler2DArray:`
    if (cv !== v)
    {
        cu.value = v;

        gl.uniform1i(location, v);
    }`},qe={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};function Ze(t,e){const r=[`
        var v = null;
        var cv = null;
        var cu = null;
        var t = 0;
        var gl = renderer.gl;
    `];for(const s in t.uniforms){const i=e[s];if(!i){t.uniforms[s]instanceof A?t.uniforms[s].ubo?r.push(`
                        renderer.shader.bindUniformBlock(uv.${s}, "${s}");
                    `):r.push(`
                        renderer.shader.updateUniformGroup(uv.${s});
                    `):t.uniforms[s]instanceof te&&r.push(`
                        renderer.shader.bindBufferResource(uv.${s}, "${s}");
                    `);continue}const n=t.uniforms[s];let a=!1;for(let o=0;o<C.length;o++)if(C[o].test(i,n)){r.push(C[o].code(s,n)),a=!0;break}if(!a){const c=(i.size===1&&!i.isArray?Ye:qe)[i.type].replace("location",`ud["${s}"].location`);r.push(`
            cu = ud["${s}"];
            cv = cu.value;
            v = uv["${s}"];
            ${c};`)}}return new Function("ud","uv","renderer","syncData",r.join(`
`))}class me{constructor(e){this._cache={},this._uniformGroupSyncHash={},this._renderer=e,this._systemCheck(),this.gl=null,this._cache={}}_systemCheck(){if(!je())throw new Error("Current environment does not allow unsafe-eval, please use pixi.js/unsafe-eval module to enable support.")}contextChange(e){this.gl=e}updateUniformGroup(e,r,s){const i=this._renderer.shader._getProgramData(r);(!e.isStatic||e._dirtyId!==i.uniformDirtyGroups[e.uid])&&(i.uniformDirtyGroups[e.uid]=e._dirtyId,this._getUniformSyncFunction(e,r)(i.uniformData,e.uniforms,this._renderer,s))}_getUniformSyncFunction(e,r){return this._uniformGroupSyncHash[e._signature]?.[r._key]||this._createUniformSyncFunction(e,r)}_createUniformSyncFunction(e,r){const s=this._uniformGroupSyncHash[e._signature]||(this._uniformGroupSyncHash[e._signature]={}),i=this._getSignature(e,r._uniformData,"u");return this._cache[i]||(this._cache[i]=Ze(e,r._uniformData)),s[r._key]=this._cache[i],s[r._key]}_getSignature(e,r,s){const i=e.uniforms,n=[`${s}-`];for(const a in i)n.push(a),r[a]&&n.push(r[a].type);return n.join("-")}destroy(){this._renderer=null,this._cache=null}}me.extension={type:[d.WebGLSystem],name:"uniformGroup"};function Qe(t){const e={};return e.normal=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e.add=[t.ONE,t.ONE],e.multiply=[t.DST_COLOR,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA],e.screen=[t.ONE,t.ONE_MINUS_SRC_COLOR,t.ONE,t.ONE_MINUS_SRC_ALPHA],e.none=[0,0],e["normal-npm"]=[t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA],e["add-npm"]=[t.SRC_ALPHA,t.ONE,t.ONE,t.ONE],e["screen-npm"]=[t.SRC_ALPHA,t.ONE_MINUS_SRC_COLOR,t.ONE,t.ONE_MINUS_SRC_ALPHA],e.erase=[t.ZERO,t.ONE_MINUS_SRC_ALPHA],e}const Je=0,et=1,tt=2,rt=3,st=4,it=5,P=class{constructor(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode="none",this._blendEq=!1,this.map=[],this.map[Je]=this.setBlend,this.map[et]=this.setOffset,this.map[tt]=this.setCullFace,this.map[rt]=this.setDepthTest,this.map[st]=this.setFrontFace,this.map[it]=this.setDepthMask,this.checks=[],this.defaultState=new F,this.defaultState.blend=!0}contextChange(t){this.gl=t,this.blendModesMap=Qe(t),this.set(this.defaultState),this.reset()}set(t){if(t=t||this.defaultState,this.stateId!==t.data){let e=this.stateId^t.data,r=0;for(;e;)e&1&&this.map[r].call(this,!!(t.data&1<<r)),e=e>>1,r++;this.stateId=t.data}for(let e=0;e<this.checks.length;e++)this.checks[e](this,t)}forceState(t){t=t||this.defaultState;for(let e=0;e<this.map.length;e++)this.map[e].call(this,!!(t.data&1<<e));for(let e=0;e<this.checks.length;e++)this.checks[e](this,t);this.stateId=t.data}setBlend(t){this._updateCheck(P._checkBlendMode,t),this.gl[t?"enable":"disable"](this.gl.BLEND)}setOffset(t){this._updateCheck(P._checkPolygonOffset,t),this.gl[t?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(t){this.gl[t?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(t){this.gl.depthMask(t)}setCullFace(t){this.gl[t?"enable":"disable"](this.gl.CULL_FACE)}setFrontFace(t){this.gl.frontFace(this.gl[t?"CW":"CCW"])}setBlendMode(t){if(this.blendModesMap[t]||(t="normal"),t===this.blendMode)return;this.blendMode=t;const e=this.blendModesMap[t],r=this.gl;e.length===2?r.blendFunc(e[0],e[1]):r.blendFuncSeparate(e[0],e[1],e[2],e[3]),e.length===6?(this._blendEq=!0,r.blendEquationSeparate(e[4],e[5])):this._blendEq&&(this._blendEq=!1,r.blendEquationSeparate(r.FUNC_ADD,r.FUNC_ADD))}setPolygonOffset(t,e){this.gl.polygonOffset(t,e)}reset(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode="",this.setBlendMode("normal")}_updateCheck(t,e){const r=this.checks.indexOf(t);e&&r===-1?this.checks.push(t):!e&&r!==-1&&this.checks.splice(r,1)}static _checkBlendMode(t,e){t.setBlendMode(e.blendMode)}static _checkPolygonOffset(t,e){t.setPolygonOffset(1,e.polygonOffset)}destroy(){this.gl=null,this.checks.length=0}};let Ee=P;Ee.extension={type:[d.WebGLSystem],name:"state"};class nt{constructor(e){this.target=ne.TEXTURE_2D,this.texture=e,this.width=-1,this.height=-1,this.type=f.UNSIGNED_BYTE,this.internalFormat=G.RGBA,this.format=G.RGBA,this.samplerType=0}}const at={id:"image",upload(t,e,r){e.width===t.width||e.height===t.height?r.texSubImage2D(r.TEXTURE_2D,0,0,0,e.format,e.type,t.resource):r.texImage2D(e.target,0,e.internalFormat,t.width,t.height,0,e.format,e.type,t.resource),e.width=t.width,e.height=t.height}},ot={"bc2-rgba-unorm":!0,"bc3-rgba-unorm":!0,"bc7-rgba-unorm":!0,"etc2-rgba8unorm":!0,"astc-4x4-unorm":!0},ct={id:"compressed",upload(t,e,r){r.pixelStorei(r.UNPACK_ALIGNMENT,4);let s=t.pixelWidth,i=t.pixelHeight;const n=!!ot[t.format];for(let a=0;a<t.resource.length;a++){const o=t.resource[a];n?r.compressedTexImage2D(r.TEXTURE_2D,a,e.internalFormat,s,i,0,o):r.texImage2D(r.TEXTURE_2D,a,e.internalFormat,s,i,0,e.format,e.type,o),s=Math.max(s>>1,1),i=Math.max(i>>1,1)}}},ve={id:"image",upload(t,e,r){const s=t.alphaMode==="premultiply-alpha-on-upload";r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s);const i=e.width,n=e.height,a=t.pixelWidth,o=t.pixelHeight,c=t.resourceWidth,u=t.resourceHeight;c<a||u<o?((i!==a||n!==o)&&r.texImage2D(e.target,0,e.internalFormat,a,o,0,e.format,e.type,null),r.texSubImage2D(r.TEXTURE_2D,0,0,0,c,u,e.format,e.type,t.resource)):i===a||n===o?r.texSubImage2D(r.TEXTURE_2D,0,0,0,e.format,e.type,t.resource):r.texImage2D(e.target,0,e.internalFormat,a,o,0,e.format,e.type,t.resource),e.width=a,e.height=o}},ut={id:"video",upload(t,e,r){if(!t.isValid){r.texImage2D(e.target,0,e.internalFormat,1,1,0,e.format,e.type,null);return}ve.upload(t,e,r)}},$={linear:9729,nearest:9728},lt={linear:{linear:9987,nearest:9985},nearest:{linear:9986,nearest:9984}},U={"clamp-to-edge":33071,repeat:10497,"mirror-repeat":33648},ft={never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519};function K(t,e,r,s,i,n){const a=n;if(e[i](a,e.TEXTURE_WRAP_S,U[t.addressModeU]),e[i](a,e.TEXTURE_WRAP_T,U[t.addressModeV]),e[i](a,e.TEXTURE_WRAP_R,U[t.addressModeW]),e[i](a,e.TEXTURE_MAG_FILTER,$[t.magFilter]),r){const o=lt[t.minFilter][t.mipmapFilter];e[i](a,e.TEXTURE_MIN_FILTER,o)}else e[i](a,e.TEXTURE_MIN_FILTER,$[t.minFilter]);if(s&&t.maxAnisotropy>1){const o=Math.min(t.maxAnisotropy,e.getParameter(s.MAX_TEXTURE_MAX_ANISOTROPY_EXT));e[i](a,s.TEXTURE_MAX_ANISOTROPY_EXT,o)}t.compare&&e[i](a,e.TEXTURE_COMPARE_FUNC,ft[t.compare])}function _t(t){return{r8unorm:t.RED,r8snorm:t.RED,r8uint:t.RED,r8sint:t.RED,r16uint:t.RED,r16sint:t.RED,r16float:t.RED,rg8unorm:t.RG,rg8snorm:t.RG,rg8uint:t.RG,rg8sint:t.RG,r32uint:t.RED,r32sint:t.RED,r32float:t.RED,rg16uint:t.RG,rg16sint:t.RG,rg16float:t.RG,rgba8unorm:t.RGBA,"rgba8unorm-srgb":t.RGBA,rgba8snorm:t.RGBA,rgba8uint:t.RGBA,rgba8sint:t.RGBA,bgra8unorm:t.RGBA,"bgra8unorm-srgb":t.RGBA,rgb9e5ufloat:t.RGB,rgb10a2unorm:t.RGBA,rg11b10ufloat:t.RGB,rg32uint:t.RG,rg32sint:t.RG,rg32float:t.RG,rgba16uint:t.RGBA,rgba16sint:t.RGBA,rgba16float:t.RGBA,rgba32uint:t.RGBA,rgba32sint:t.RGBA,rgba32float:t.RGBA,stencil8:t.STENCIL_INDEX8,depth16unorm:t.DEPTH_COMPONENT,depth24plus:t.DEPTH_COMPONENT,"depth24plus-stencil8":t.DEPTH_STENCIL,depth32float:t.DEPTH_COMPONENT,"depth32float-stencil8":t.DEPTH_STENCIL}}function ht(t,e){return{r8unorm:t.R8,r8snorm:t.R8_SNORM,r8uint:t.R8UI,r8sint:t.R8I,r16uint:t.R16UI,r16sint:t.R16I,r16float:t.R16F,rg8unorm:t.RG8,rg8snorm:t.RG8_SNORM,rg8uint:t.RG8UI,rg8sint:t.RG8I,r32uint:t.R32UI,r32sint:t.R32I,r32float:t.R32F,rg16uint:t.RG16UI,rg16sint:t.RG16I,rg16float:t.RG16F,rgba8unorm:t.RGBA,"rgba8unorm-srgb":t.SRGB8_ALPHA8,rgba8snorm:t.RGBA8_SNORM,rgba8uint:t.RGBA8UI,rgba8sint:t.RGBA8I,bgra8unorm:t.RGBA8,"bgra8unorm-srgb":t.SRGB8_ALPHA8,rgb9e5ufloat:t.RGB9_E5,rgb10a2unorm:t.RGB10_A2,rg11b10ufloat:t.R11F_G11F_B10F,rg32uint:t.RG32UI,rg32sint:t.RG32I,rg32float:t.RG32F,rgba16uint:t.RGBA16UI,rgba16sint:t.RGBA16I,rgba16float:t.RGBA16F,rgba32uint:t.RGBA32UI,rgba32sint:t.RGBA32I,rgba32float:t.RGBA32F,stencil8:t.STENCIL_INDEX8,depth16unorm:t.DEPTH_COMPONENT16,depth24plus:t.DEPTH_COMPONENT24,"depth24plus-stencil8":t.DEPTH24_STENCIL8,depth32float:t.DEPTH_COMPONENT32F,"depth32float-stencil8":t.DEPTH32F_STENCIL8,...e.s3tc?{"bc2-rgba-unorm":e.s3tc.COMPRESSED_RGBA_S3TC_DXT3_EXT,"bc3-rgba-unorm":e.s3tc.COMPRESSED_RGBA_S3TC_DXT5_EXT}:{},...e.s3tc_sRGB?{"bc2-rgba-unorm-srgb":e.s3tc_sRGB.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,"bc3-rgba-unorm-srgb":e.s3tc_sRGB.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}:{},...e.bptc?{"bc7-rgba-unorm":e.bptc.COMPRESSED_RGBA_BPTC_UNORM_EXT,"bc7-rgba-unorm-srgb":e.bptc.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT}:{},...e.etc?{"etc2-rgb8unorm":e.etc.COMPRESSED_RGB8_ETC2,"etc2-rgb8unorm-srgb":e.etc.COMPRESSED_SRGB8_ETC2,"etc2-rgb8a1unorm":e.etc.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,"etc2-rgb8a1unorm-srgb":e.etc.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,"etc2-rgba8unorm":e.etc.COMPRESSED_RGBA8_ETC2_EAC,"etc2-rgba8unorm-srgb":e.etc.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC,"eac-r11unorm":e.etc.COMPRESSED_R11_EAC,"eac-rg11unorm":e.etc.COMPRESSED_SIGNED_RG11_EAC}:{},...e.astc?{"astc-4x4-unorm":e.astc.COMPRESSED_RGBA_ASTC_4x4_KHR,"astc-4x4-unorm-srgb":e.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR,"astc-5x5-unorm":e.astc.COMPRESSED_RGBA_ASTC_5x5_KHR,"astc-5x5-unorm-srgb":e.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR,"astc-6x5-unorm":e.astc.COMPRESSED_RGBA_ASTC_6x5_KHR,"astc-6x5-unorm-srgb":e.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR,"astc-6x6-unorm":e.astc.COMPRESSED_RGBA_ASTC_6x6_KHR,"astc-6x6-unorm-srgb":e.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR,"astc-8x5-unorm":e.astc.COMPRESSED_RGBA_ASTC_8x5_KHR,"astc-8x5-unorm-srgb":e.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR,"astc-8x6-unorm":e.astc.COMPRESSED_RGBA_ASTC_8x6_KHR,"astc-8x6-unorm-srgb":e.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR,"astc-8x8-unorm":e.astc.COMPRESSED_RGBA_ASTC_8x8_KHR,"astc-8x8-unorm-srgb":e.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR,"astc-10x5-unorm":e.astc.COMPRESSED_RGBA_ASTC_10x5_KHR,"astc-10x5-unorm-srgb":e.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR,"astc-10x6-unorm":e.astc.COMPRESSED_RGBA_ASTC_10x6_KHR,"astc-10x6-unorm-srgb":e.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR,"astc-10x8-unorm":e.astc.COMPRESSED_RGBA_ASTC_10x8_KHR,"astc-10x8-unorm-srgb":e.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR,"astc-10x10-unorm":e.astc.COMPRESSED_RGBA_ASTC_10x10_KHR,"astc-10x10-unorm-srgb":e.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR,"astc-12x10-unorm":e.astc.COMPRESSED_RGBA_ASTC_12x10_KHR,"astc-12x10-unorm-srgb":e.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR,"astc-12x12-unorm":e.astc.COMPRESSED_RGBA_ASTC_12x12_KHR,"astc-12x12-unorm-srgb":e.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR}:{}}}function dt(t){return{r8unorm:t.UNSIGNED_BYTE,r8snorm:t.BYTE,r8uint:t.UNSIGNED_BYTE,r8sint:t.BYTE,r16uint:t.UNSIGNED_SHORT,r16sint:t.SHORT,r16float:t.HALF_FLOAT,rg8unorm:t.UNSIGNED_BYTE,rg8snorm:t.BYTE,rg8uint:t.UNSIGNED_BYTE,rg8sint:t.BYTE,r32uint:t.UNSIGNED_INT,r32sint:t.INT,r32float:t.FLOAT,rg16uint:t.UNSIGNED_SHORT,rg16sint:t.SHORT,rg16float:t.HALF_FLOAT,rgba8unorm:t.UNSIGNED_BYTE,"rgba8unorm-srgb":t.UNSIGNED_BYTE,rgba8snorm:t.BYTE,rgba8uint:t.UNSIGNED_BYTE,rgba8sint:t.BYTE,bgra8unorm:t.UNSIGNED_BYTE,"bgra8unorm-srgb":t.UNSIGNED_BYTE,rgb9e5ufloat:t.UNSIGNED_INT_5_9_9_9_REV,rgb10a2unorm:t.UNSIGNED_INT_2_10_10_10_REV,rg11b10ufloat:t.UNSIGNED_INT_10F_11F_11F_REV,rg32uint:t.UNSIGNED_INT,rg32sint:t.INT,rg32float:t.FLOAT,rgba16uint:t.UNSIGNED_SHORT,rgba16sint:t.SHORT,rgba16float:t.HALF_FLOAT,rgba32uint:t.UNSIGNED_INT,rgba32sint:t.INT,rgba32float:t.FLOAT,stencil8:t.UNSIGNED_BYTE,depth16unorm:t.UNSIGNED_SHORT,depth24plus:t.UNSIGNED_INT,"depth24plus-stencil8":t.UNSIGNED_INT_24_8,depth32float:t.FLOAT,"depth32float-stencil8":t.FLOAT_32_UNSIGNED_INT_24_8_REV}}const mt=new q,Et=4;class pe{constructor(e){this.managedTextures=[],this._glTextures=Object.create(null),this._glSamplers=Object.create(null),this._boundTextures=[],this._activeTextureLocation=-1,this._boundSamplers=Object.create(null),this._uploads={image:ve,buffer:at,video:ut,compressed:ct},this._useSeparateSamplers=!1,this._renderer=e}contextChange(e){if(this._gl=e,!this._mapFormatToInternalFormat){const r=this._renderer.context.extensions;this._mapFormatToInternalFormat=ht(e,r),this._mapFormatToType=dt(e),this._mapFormatToFormat=_t(e)}for(let r=0;r<16;r++)this.bind(p.EMPTY,r)}bind(e,r=0){const s=e.source;e?(this.bindSource(s,r),this._useSeparateSamplers&&this._bindSampler(s.style,r)):(this.bindSource(null,r),this._useSeparateSamplers&&this._bindSampler(null,r))}bindSource(e,r=0){const s=this._gl;if(e._touched=this._renderer.textureGC.count,this._boundTextures[r]!==e){this._boundTextures[r]=e,this._activateLocation(r),e=e||p.EMPTY.source;const i=this.getGlSource(e);s.bindTexture(i.target,i.texture)}}_bindSampler(e,r=0){const s=this._gl;if(!e){this._boundSamplers[r]=null,s.bindSampler(r,null);return}const i=this._getGlSampler(e);this._boundSamplers[r]!==i&&(this._boundSamplers[r]=i,s.bindSampler(r,i))}unbind(e){const r=e.source,s=this._boundTextures,i=this._gl;for(let n=0;n<s.length;n++)if(s[n]===r){this._activateLocation(n);const a=this.getGlSource(r);i.bindTexture(a.target,null),s[n]=null}}_activateLocation(e){this._activeTextureLocation!==e&&(this._activeTextureLocation=e,this._gl.activeTexture(this._gl.TEXTURE0+e))}_initSource(e){const r=this._gl,s=new nt(r.createTexture());if(s.type=this._mapFormatToType[e.format],s.internalFormat=this._mapFormatToInternalFormat[e.format],s.format=this._mapFormatToFormat[e.format],e.autoGenerateMipmaps){const i=Math.max(e.width,e.height);e.mipLevelCount=Math.floor(Math.log2(i))+1}return this._glTextures[e.uid]=s,e.on("update",this.onSourceUpdate,this),e.on("resize",this.onSourceUpdate,this),e.on("styleChange",this.onStyleChange,this),e.on("destroy",this.onSourceDestroy,this),e.on("unload",this.onSourceUnload,this),this.managedTextures.push(e),this.onSourceUpdate(e),this.onStyleChange(e),s}onStyleChange(e){const r=this._gl,s=this._glTextures[e.uid];r.bindTexture(r.TEXTURE_2D,s.texture),this._boundTextures[this._activeTextureLocation]=e,K(e.style,r,e.mipLevelCount>1,this._renderer.context.extensions.anisotropicFiltering,"texParameteri",r.TEXTURE_2D)}onSourceUnload(e){const r=this._glTextures[e.uid];r&&(this.unbind(e),this._glTextures[e.uid]=null,this._gl.deleteTexture(r.texture))}onSourceUpdate(e){const r=this._gl,s=this.getGlSource(e);r.bindTexture(r.TEXTURE_2D,s.texture),this._boundTextures[this._activeTextureLocation]=e,this._uploads[e.uploadMethodId]?(this._uploads[e.uploadMethodId].upload(e,s,this._gl),e.autoGenerateMipmaps&&e.mipLevelCount>1&&r.generateMipmap(s.target)):r.texImage2D(r.TEXTURE_2D,0,r.RGBA,e.pixelWidth,e.pixelHeight,0,r.RGBA,r.UNSIGNED_BYTE,null)}onSourceDestroy(e){e.off("destroy",this.onSourceDestroy,this),e.off("update",this.onSourceUpdate,this),e.off("unload",this.onSourceUnload,this),e.off("styleChange",this.onStyleChange,this),this.managedTextures.splice(this.managedTextures.indexOf(e),1),this.onSourceUnload(e)}_initSampler(e){const r=this._gl,s=this._gl.createSampler();return this._glSamplers[e._resourceId]=s,K(e,r,this._boundTextures[this._activeTextureLocation].mipLevelCount>1,this._renderer.context.extensions.anisotropicFiltering,"samplerParameteri",s),this._glSamplers[e._resourceId]}_getGlSampler(e){return this._glSamplers[e._resourceId]||this._initSampler(e)}getGlSource(e){return this._glTextures[e.uid]||this._initSource(e)}generateCanvas(e){const{pixels:r,width:s,height:i}=this.getPixels(e),n=Ae.get().createCanvas();n.width=s,n.height=i;const a=n.getContext("2d");if(a){const o=a.createImageData(s,i);o.data.set(r),a.putImageData(o,0,0)}return n}getPixels(e){const r=e.source.resolution,s=mt;s.x=e.frameX,s.y=e.frameY,s.width=e.frameWidth,s.height=e.frameHeight;const i=Math.max(Math.round(s.width*r),1),n=Math.max(Math.round(s.height*r),1),a=new Uint8Array(Et*i*n),o=this._renderer,c=o.renderTarget.getRenderTarget(e),u=o.renderTarget.getGpuRenderTarget(c),l=o.gl;return l.bindFramebuffer(l.FRAMEBUFFER,u.resolveTargetFramebuffer),l.readPixels(Math.round(s.x*r),Math.round(s.y*r),i,n,l.RGBA,l.UNSIGNED_BYTE,a),{pixels:new Uint8ClampedArray(a.buffer),width:i,height:n}}destroy(){this.managedTextures.slice().forEach(e=>this.onSourceDestroy(e)),this.managedTextures=null,this._renderer=null}}pe.extension={type:[d.WebGLSystem],name:"texture"};class be{init(){const e=new A({uColor:{value:new Float32Array([1,1,1,1]),type:"vec4<f32>"},uTransformMatrix:{value:new j,type:"mat3x3<f32>"}}),r=O({name:"graphics",bits:[Z,Q(ee),re,M]});this.shader=new B({glProgram:r,resources:{localUniforms:e,batchSamplers:J}})}execute(e,r){const s=r.view.context,i=s.customShader||this.shader,n=e.renderer,a=n.graphicsContext,{geometry:o,instructions:c}=a.getContextRenderData(s);n.shader.bind(i),n.shader.bindUniformBlock(n.globalUniforms.uniformGroup,"globalUniforms"),n.geometry.bind(o,i.glProgram);const u=c.instructions;for(let l=0;l<c.instructionSize;l++){const _=u[l];if(_.size){for(let m=0;m<_.textures.textures.length;m++)n.texture.bind(_.textures.textures[m],m);n.geometry.draw("triangle-list",_.size,_.start)}}}destroy(){this.shader.destroy(!0),this.shader=null}}be.extension={type:[d.WebGLPipesAdaptor],name:"graphics"};class Re{init(){const e=O({name:"mesh",bits:[re,De,M]});this._shader=new B({glProgram:e,resources:{uTexture:p.EMPTY.source}}),this._shader.addResource("globalUniforms",0,0),this._shader.addResource("localUniforms",1,0)}execute(e,r){const s=e.renderer,i=r.view;let n=i._shader;if(!n){n=this._shader;const a=i.texture.source;n.resources.uTexture=a,n.resources.uSampler=a.style}n.groups[0]=s.globalUniforms.bindGroup,n.groups[1]=e.localUniformsBindGroup,s.encoder.draw({geometry:i._geometry,shader:n,state:i.state})}destroy(){this._shader.destroy(!0),this._shader=null}}Re.extension={type:[d.WebGLPipesAdaptor],name:"mesh"};const vt=[...Ce,L,H,ie,pe,le,ae,me,de,ue,Ee,fe,ce],pt=[...Ue],bt=[se,Re,be],Se=[],ge=[],Te=[];T.handleByNamedList(d.WebGLSystem,Se);T.handleByNamedList(d.WebGLPipes,ge);T.handleByNamedList(d.WebGLPipesAdaptor,Te);T.add(...vt,...pt,...bt);class Bt extends Be{constructor(){const e={name:"webgl2",type:ye.WEBGL,systems:Se,renderPipes:ge,renderPipeAdaptors:Te};super(e)}}export{Bt as WebGLRenderer};
