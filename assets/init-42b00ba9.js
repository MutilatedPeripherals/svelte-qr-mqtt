import{E as f,b as x,D as b,h as T,w,T as R,B as ie,i as U,G as Ie,I as re,a as $,g as C,j as we,k as ae,l as Be,m as ke,M as Te,C as Pe}from"./CanvasTest-18dd6528.js";import{S as Q,C as Fe}from"./CanvasSource-e2ba726f.js";class ne{static init(t){Object.defineProperty(this,"resizeTo",{set(s){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=s,s&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{this._resizeTo&&(this._cancelResize(),this._resizeId=requestAnimationFrame(()=>this.resize()))},this._cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;this._cancelResize();let s,i;if(this._resizeTo===globalThis.window)s=globalThis.innerWidth,i=globalThis.innerHeight;else{const{clientWidth:r,clientHeight:a}=this._resizeTo;s=r,i=a}this.renderer.resize(s,i),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=t.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this._cancelResize(),this._cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}}ne.extension=f.Application;var L=(e=>(e[e.INTERACTION=50]="INTERACTION",e[e.HIGH=25]="HIGH",e[e.NORMAL=0]="NORMAL",e[e.LOW=-25]="LOW",e[e.UTILITY=-50]="UTILITY",e))(L||{});class N{constructor(t,s=null,i=0,r=!1){this.next=null,this.previous=null,this._destroyed=!1,this._fn=t,this._context=s,this.priority=i,this._once=r}match(t,s=null){return this._fn===t&&this._context===s}emit(t){this._fn&&(this._context?this._fn.call(this._context,t):this._fn(t));const s=this.next;return this._once&&this.destroy(!0),this._destroyed&&(this.next=null),s}connect(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this}destroy(t=!1){this._destroyed=!0,this._fn=null,this._context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const s=this.next;return this.next=t?null:s,this.previous=null,s}}const p=class{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new N(null,null,1/0),this.deltaMS=1/p.targetFPMS,this.elapsedMS=1/p.targetFPMS,this._tick=e=>{this._requestId=null,this.started&&(this.update(e),this.started&&this._requestId===null&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(e,t,s=L.NORMAL){return this._addListener(new N(e,t,s))}addOnce(e,t,s=L.NORMAL){return this._addListener(new N(e,t,s,!0))}_addListener(e){let t=this._head.next,s=this._head;if(!t)e.connect(s);else{for(;t;){if(e.priority>t.priority){e.connect(s);break}s=t,t=t.next}e.previous||e.connect(s)}return this._startIfPossible(),this}remove(e,t){let s=this._head.next;for(;s;)s.match(e,t)?s=s.destroy():s=s.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let e=0,t=this._head;for(;t=t.next;)e++;return e}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let e=this._head.next;for(;e;)e=e.destroy(!0);this._head.destroy(),this._head=null}}update(e=performance.now()){let t;if(e>this.lastTime){if(t=this.elapsedMS=e-this.lastTime,t>this._maxElapsedMS&&(t=this._maxElapsedMS),t*=this.speed,this._minElapsedMS){const r=e-this._lastFrame|0;if(r<this._minElapsedMS)return;this._lastFrame=e-r%this._minElapsedMS}this.deltaMS=t,this.deltaTime=this.deltaMS*p.targetFPMS;const s=this._head;let i=s.next;for(;i;)i=i.emit(this);s.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=e}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(e){const t=Math.min(this.maxFPS,e),s=Math.min(Math.max(0,t)/1e3,p.targetFPMS);this._maxElapsedMS=1/s}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(e){if(e===0)this._minElapsedMS=0;else{const t=Math.max(this.minFPS,e);this._minElapsedMS=1/(t/1e3)}}static get shared(){if(!p._shared){const e=p._shared=new p;e.autoStart=!0,e._protected=!0}return p._shared}static get system(){if(!p._system){const e=p._system=new p;e.autoStart=!0,e._protected=!0}return p._system}};let S=p;S.targetFPMS=.06;class oe{static init(t){t=Object.assign({autoStart:!0,sharedTicker:!1},t),Object.defineProperty(this,"ticker",{set(s){this._ticker&&this._ticker.remove(this.render,this),this._ticker=s,s&&s.add(this.render,this,L.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=t.sharedTicker?S.shared:new S,t.autoStart&&this.start()}static destroy(){if(this._ticker){const t=this._ticker;this.ticker=null,t.destroy()}}}oe.extension=f.Application;x.add(ne);x.add(oe);function g(e){if(typeof e!="string")throw new TypeError(`Path must be a string. Received ${JSON.stringify(e)}`)}function P(e){return e.split("?")[0].split("#")[0]}function Me(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Ce(e,t,s){return e.replace(new RegExp(Me(t),"g"),s)}function Re(e,t){let s="",i=0,r=-1,a=0,o=-1;for(let n=0;n<=e.length;++n){if(n<e.length)o=e.charCodeAt(n);else{if(o===47)break;o=47}if(o===47){if(!(r===n-1||a===1))if(r!==n-1&&a===2){if(s.length<2||i!==2||s.charCodeAt(s.length-1)!==46||s.charCodeAt(s.length-2)!==46){if(s.length>2){const c=s.lastIndexOf("/");if(c!==s.length-1){c===-1?(s="",i=0):(s=s.slice(0,c),i=s.length-1-s.lastIndexOf("/")),r=n,a=0;continue}}else if(s.length===2||s.length===1){s="",i=0,r=n,a=0;continue}}t&&(s.length>0?s+="/..":s="..",i=2)}else s.length>0?s+=`/${e.slice(r+1,n)}`:s=e.slice(r+1,n),i=n-r-1;r=n,a=0}else o===46&&a!==-1?++a:a=-1}return s}const _={toPosix(e){return Ce(e,"\\","/")},isUrl(e){return/^https?:/.test(this.toPosix(e))},isDataUrl(e){return/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(e)},isBlobUrl(e){return e.startsWith("blob:")},hasProtocol(e){return/^[^/:]+:/.test(this.toPosix(e))},getProtocol(e){g(e),e=this.toPosix(e);const t=/^file:\/\/\//.exec(e);if(t)return t[0];const s=/^[^/:]+:\/{0,2}/.exec(e);return s?s[0]:""},toAbsolute(e,t,s){if(g(e),this.isDataUrl(e)||this.isBlobUrl(e))return e;const i=P(this.toPosix(t??b.get().getBaseUrl())),r=P(this.toPosix(s??this.rootname(i)));return e=this.toPosix(e),e.startsWith("/")?_.join(r,e.slice(1)):this.isAbsolute(e)?e:this.join(i,e)},normalize(e){if(g(e),e.length===0)return".";if(this.isDataUrl(e)||this.isBlobUrl(e))return e;e=this.toPosix(e);let t="";const s=e.startsWith("/");this.hasProtocol(e)&&(t=this.rootname(e),e=e.slice(t.length));const i=e.endsWith("/");return e=Re(e,!1),e.length>0&&i&&(e+="/"),s?`/${e}`:t+e},isAbsolute(e){return g(e),e=this.toPosix(e),this.hasProtocol(e)?!0:e.startsWith("/")},join(...e){if(e.length===0)return".";let t;for(let s=0;s<e.length;++s){const i=e[s];if(g(i),i.length>0)if(t===void 0)t=i;else{const r=e[s-1]??"";this.extname(r)?t+=`/../${i}`:t+=`/${i}`}}return t===void 0?".":this.normalize(t)},dirname(e){if(g(e),e.length===0)return".";e=this.toPosix(e);let t=e.charCodeAt(0);const s=t===47;let i=-1,r=!0;const a=this.getProtocol(e),o=e;e=e.slice(a.length);for(let n=e.length-1;n>=1;--n)if(t=e.charCodeAt(n),t===47){if(!r){i=n;break}}else r=!1;return i===-1?s?"/":this.isUrl(o)?a+e:a:s&&i===1?"//":a+e.slice(0,i)},rootname(e){g(e),e=this.toPosix(e);let t="";if(e.startsWith("/")?t="/":t=this.getProtocol(e),this.isUrl(e)){const s=e.indexOf("/",t.length);s!==-1?t=e.slice(0,s):t=e,t.endsWith("/")||(t+="/")}return t},basename(e,t){g(e),t&&g(t),e=P(this.toPosix(e));let s=0,i=-1,r=!0,a;if(t!==void 0&&t.length>0&&t.length<=e.length){if(t.length===e.length&&t===e)return"";let o=t.length-1,n=-1;for(a=e.length-1;a>=0;--a){const c=e.charCodeAt(a);if(c===47){if(!r){s=a+1;break}}else n===-1&&(r=!1,n=a+1),o>=0&&(c===t.charCodeAt(o)?--o===-1&&(i=a):(o=-1,i=n))}return s===i?i=n:i===-1&&(i=e.length),e.slice(s,i)}for(a=e.length-1;a>=0;--a)if(e.charCodeAt(a)===47){if(!r){s=a+1;break}}else i===-1&&(r=!1,i=a+1);return i===-1?"":e.slice(s,i)},extname(e){g(e),e=P(this.toPosix(e));let t=-1,s=0,i=-1,r=!0,a=0;for(let o=e.length-1;o>=0;--o){const n=e.charCodeAt(o);if(n===47){if(!r){s=o+1;break}continue}i===-1&&(r=!1,i=o+1),n===46?t===-1?t=o:a!==1&&(a=1):t!==-1&&(a=-1)}return t===-1||i===-1||a===0||a===1&&t===i-1&&t===s+1?"":e.slice(t,i)},parse(e){g(e);const t={root:"",dir:"",base:"",ext:"",name:""};if(e.length===0)return t;e=P(this.toPosix(e));let s=e.charCodeAt(0);const i=this.isAbsolute(e);let r;t.root=this.rootname(e),i||this.hasProtocol(e)?r=1:r=0;let a=-1,o=0,n=-1,c=!0,l=e.length-1,h=0;for(;l>=r;--l){if(s=e.charCodeAt(l),s===47){if(!c){o=l+1;break}continue}n===-1&&(c=!1,n=l+1),s===46?a===-1?a=l:h!==1&&(h=1):a!==-1&&(h=-1)}return a===-1||n===-1||h===0||h===1&&a===n-1&&a===o+1?n!==-1&&(o===0&&i?t.base=t.name=e.slice(1,n):t.base=t.name=e.slice(o,n)):(o===0&&i?(t.name=e.slice(1,a),t.base=e.slice(1,n)):(t.name=e.slice(o,a),t.base=e.slice(o,n)),t.ext=e.slice(a,n)),t.dir=this.dirname(e),t},sep:"/",delimiter:":"},Z=e=>!Array.isArray(e);function le(e,t,s,i,r){const a=t[s];for(let o=0;o<a.length;o++){const n=a[o];s<t.length-1?le(e.replace(i[s],n),t,s+1,i,r):r.push(e.replace(i[s],n))}}function Ue(e){const t=/\{(.*?)\}/g,s=e.match(t),i=[];if(s){const r=[];s.forEach(a=>{const o=a.substring(1,a.length-1).split(",");r.push(o)}),le(e,r,0,s,i)}else i.push(e);return i}class O{constructor(){this._defaultBundleIdentifierOptions={connector:"-",createBundleAssetId:(t,s)=>`${t}${this._bundleIdConnector}${s}`,extractAssetIdFromBundle:(t,s)=>s.replace(`${t}${this._bundleIdConnector}`,"")},this._bundleIdConnector=this._defaultBundleIdentifierOptions.connector,this._createBundleAssetId=this._defaultBundleIdentifierOptions.createBundleAssetId,this._extractAssetIdFromBundle=this._defaultBundleIdentifierOptions.extractAssetIdFromBundle,this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(t){if(this._bundleIdConnector=t.connector??this._bundleIdConnector,this._createBundleAssetId=t.createBundleAssetId??this._createBundleAssetId,this._extractAssetIdFromBundle=t.extractAssetIdFromBundle??this._extractAssetIdFromBundle,this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar"))!=="bar")throw new Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(...t){t.forEach(s=>{this._preferredOrder.push(s),s.priority||(s.priority=Object.keys(s.params))}),this._resolverHash={}}set basePath(t){this._basePath=t}get basePath(){return this._basePath}set rootPath(t){this._rootPath=t}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this.setBundleIdentifier(this._defaultBundleIdentifierOptions),this._assetMap={},this._preferredOrder=[],this._resolverHash={},this._rootPath=null,this._basePath=null,this._manifest=null,this._bundles={},this._defaultSearchParams=null}setDefaultSearchParams(t){if(typeof t=="string")this._defaultSearchParams=t;else{const s=t;this._defaultSearchParams=Object.keys(s).map(i=>`${encodeURIComponent(i)}=${encodeURIComponent(s[i])}`).join("&")}}getAlias(t){const{alias:s,src:i}=t;return T(s||i,a=>typeof a=="string"?a:Array.isArray(a)?a.map(o=>o?.src??o):a?.src?a.src:a,!0)}addManifest(t){this._manifest&&w("[Resolver] Manifest already exists, this will be overwritten"),this._manifest=t,t.bundles.forEach(s=>{this.addBundle(s.name,s.assets)})}addBundle(t,s){const i=[];s.forEach(r=>{const a=r.src,o=r.alias;let n;if(typeof o=="string"){const c=this._createBundleAssetId(t,o);i.push(c),n=[o,c]}else{const c=o.map(l=>this._createBundleAssetId(t,l));i.push(...c),n=[...o,...c]}this.add({...r,alias:n,src:a})}),this._bundles[t]=i}add(t){const s=[];Array.isArray(t)?s.push(...t):s.push(t);let i;i=a=>{this.hasKey(a)&&w(`[Resolver] already has key: ${a} overwriting`)},T(s).forEach(a=>{const{src:o}=a;let{data:n,format:c,loadParser:l}=a;const h=T(o).map(A=>typeof A=="string"?Ue(A):Array.isArray(A)?A:[A]),d=this.getAlias(a);Array.isArray(d)?d.forEach(i):i(d);const u=[];h.forEach(A=>{A.forEach(m=>{let y={};if(typeof m!="object"){y.src=m;for(let I=0;I<this._parsers.length;I++){const M=this._parsers[I];if(M.test(m)){y=M.parse(m);break}}}else n=m.data??n,c=m.format??c,l=m.loadParser??l,y={...y,...m};if(!d)throw new Error(`[Resolver] alias is undefined for this asset: ${y.src}`);y=this._buildResolvedAsset(y,{aliases:d,data:n,format:c,loadParser:l}),u.push(y)})}),d.forEach(A=>{this._assetMap[A]=u})})}resolveBundle(t){const s=Z(t);t=T(t);const i={};return t.forEach(r=>{const a=this._bundles[r];if(a){const o=this.resolve(a),n={};for(const c in o){const l=o[c];n[this._extractAssetIdFromBundle(r,c)]=l}i[r]=n}}),s?i[t[0]]:i}resolveUrl(t){const s=this.resolve(t);if(typeof t!="string"){const i={};for(const r in s)i[r]=s[r].src;return i}return s.src}resolve(t){const s=Z(t);t=T(t);const i={};return t.forEach(r=>{if(!this._resolverHash[r])if(this._assetMap[r]){let a=this._assetMap[r];const o=this._getPreferredOrder(a);o?.priority.forEach(n=>{o.params[n].forEach(c=>{const l=a.filter(h=>h[n]?h[n]===c:!1);l.length&&(a=l)})}),this._resolverHash[r]=a[0]}else this._resolverHash[r]=this._buildResolvedAsset({alias:[r],src:r},{});i[r]=this._resolverHash[r]}),s?i[t[0]]:i}hasKey(t){return!!this._assetMap[t]}hasBundle(t){return!!this._bundles[t]}_getPreferredOrder(t){for(let s=0;s<t.length;s++){const i=t[0],r=this._preferredOrder.find(a=>a.params.format.includes(i.format));if(r)return r}return this._preferredOrder[0]}_appendDefaultSearchParams(t){if(!this._defaultSearchParams)return t;const s=/\?/.test(t)?"&":"?";return`${t}${s}${this._defaultSearchParams}`}_buildResolvedAsset(t,s){const{aliases:i,data:r,loadParser:a,format:o}=s;return(this._basePath||this._rootPath)&&(t.src=_.toAbsolute(t.src,this._basePath,this._rootPath)),t.alias=i??t.alias??[t.src],t.src=this._appendDefaultSearchParams(t.src),t.data={...r||{},...t.data},t.loadParser=a??t.loadParser,t.format=o??t.format??Le(t.src),t}}O.RETINA_PREFIX=/@([0-9\.]+)x/;function Le(e){return e.split(".").pop().split("?").shift().split("#").shift()}const Oe={extension:f.CacheParser,test:e=>Array.isArray(e)&&e.every(t=>t instanceof R),getCacheableAssets:(e,t)=>{const s={};return e.forEach(i=>{t.forEach((r,a)=>{s[i+(a===0?"":a+1)]=r})}),s}};async function ce(e){if("Image"in globalThis)return new Promise(t=>{const s=new Image;s.onload=()=>{t(!0)},s.onerror=()=>{t(!1)},s.src=e});if("createImageBitmap"in globalThis&&"fetch"in globalThis){try{const t=await(await fetch(e)).blob();await createImageBitmap(t)}catch{return!1}return!0}return!1}const Ne={extension:{type:f.DetectionParser,priority:1},test:async()=>ce("data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A="),add:async e=>[...e,"avif"],remove:async e=>e.filter(t=>t!=="avif")},K=["png","jpg","jpeg"],We={extension:{type:f.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async e=>[...e,...K],remove:async e=>e.filter(t=>!K.includes(t))},ze="WorkerGlobalScope"in globalThis&&globalThis instanceof globalThis.WorkerGlobalScope;function G(e){return ze?!1:document.createElement("video").canPlayType(e)!==""}const He={extension:{type:f.DetectionParser,priority:0},test:async()=>G("video/mp4"),add:async e=>[...e,"mp4","m4v"],remove:async e=>e.filter(t=>t!=="mp4"&&t!=="m4v")},je={extension:{type:f.DetectionParser,priority:0},test:async()=>G("video/ogg"),add:async e=>[...e,"ogv"],remove:async e=>e.filter(t=>t!=="ogv")},Ve={extension:{type:f.DetectionParser,priority:0},test:async()=>G("video/webm"),add:async e=>[...e,"webm"],remove:async e=>e.filter(t=>t!=="webm")},qe={extension:{type:f.DetectionParser,priority:0},test:async()=>ce("data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA="),add:async e=>[...e,"webp"],remove:async e=>e.filter(t=>t!=="webp")};var v=(e=>(e[e.Low=0]="Low",e[e.Normal=1]="Normal",e[e.High=2]="High",e))(v||{});const V=(e,t)=>{const s=t.split("?")[1];return s&&(e+=`?${s}`),e},W={test(e){return typeof e=="string"&&e.startsWith("info face=")},parse(e){const t=e.match(/^[a-z]+\s+.+$/gm),s={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(const d in t){const u=t[d].match(/^[a-z]+/gm)[0],A=t[d].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),m={};for(const y in A){const I=A[y].split("="),M=I[0],D=I[1].replace(/"/gm,""),X=parseFloat(D),Ee=isNaN(X)?D:X;m[M]=Ee}s[u].push(m)}const i={chars:{},pages:[],lineHeight:0,fontSize:0,fontFamily:"",distanceField:null,baseLineOffset:0},[r]=s.info,[a]=s.common,[o]=s.distanceField??[];o&&(i.distanceField={range:parseInt(o.distanceRange,10),type:o.fieldType}),i.fontSize=parseInt(r.size,10),i.fontFamily=r.face,i.lineHeight=parseInt(a.lineHeight,10);const n=s.page;for(let d=0;d<n.length;d++)i.pages.push({id:parseInt(n[d].id,10)||0,file:n[d].file});const c={};i.baseLineOffset=i.lineHeight-parseInt(a.base,10);const l=s.char;for(let d=0;d<l.length;d++){const u=l[d],A=parseInt(u.id,10);let m=u.letter??u.char??String.fromCharCode(A);m==="space"&&(m=" "),c[A]=m,i.chars[m]={id:A,page:parseInt(u.page,10)||0,x:parseInt(u.x,10),y:parseInt(u.y,10),width:parseInt(u.width,10),height:parseInt(u.height,10),xOffset:parseInt(u.xoffset,10),yOffset:parseInt(u.yoffset,10),xAdvance:parseInt(u.xadvance,10),kerning:{}}}const h=s.kerning||[];for(let d=0;d<h.length;d++){const u=parseInt(h[d].first,10),A=parseInt(h[d].second,10),m=parseInt(h[d].amount,10);i.chars[c[A]].kerning[c[u]]=m}return i}},J={test(e){const t=e;return typeof t!="string"&&"getElementsByTagName"in t&&t.getElementsByTagName("page").length&&t.getElementsByTagName("info")[0].getAttribute("face")!==null},parse(e){const t={chars:{},pages:[],lineHeight:0,fontSize:0,fontFamily:"",distanceField:null,baseLineOffset:0},s=e.getElementsByTagName("info")[0],i=e.getElementsByTagName("common")[0],r=e.getElementsByTagName("distanceField")[0];r&&(t.distanceField={type:r.getAttribute("fieldType"),range:parseInt(r.getAttribute("distanceRange"),10)});const a=e.getElementsByTagName("page"),o=e.getElementsByTagName("char"),n=e.getElementsByTagName("kerning");t.fontSize=parseInt(s.getAttribute("size"),10),t.fontFamily=s.getAttribute("face"),t.lineHeight=parseInt(i.getAttribute("lineHeight"),10);for(let l=0;l<a.length;l++)t.pages.push({id:parseInt(a[l].getAttribute("id"),10)||0,file:a[l].getAttribute("file")});const c={};t.baseLineOffset=t.lineHeight-parseInt(i.getAttribute("base"),10);for(let l=0;l<o.length;l++){const h=o[l],d=parseInt(h.getAttribute("id"),10);let u=h.getAttribute("letter")??h.getAttribute("char")??String.fromCharCode(d);u==="space"&&(u=" "),c[d]=u,t.chars[u]={id:d,page:parseInt(h.getAttribute("page"),10)||0,x:parseInt(h.getAttribute("x"),10),y:parseInt(h.getAttribute("y"),10),width:parseInt(h.getAttribute("width"),10),height:parseInt(h.getAttribute("height"),10),xOffset:parseInt(h.getAttribute("xoffset"),10),yOffset:parseInt(h.getAttribute("yoffset"),10),xAdvance:parseInt(h.getAttribute("xadvance"),10),kerning:{}}}for(let l=0;l<n.length;l++){const h=parseInt(n[l].getAttribute("first"),10),d=parseInt(n[l].getAttribute("second"),10),u=parseInt(n[l].getAttribute("amount"),10);t.chars[c[d]].kerning[c[h]]=u}return t}},Y={test(e){return typeof e=="string"&&e.includes("<font>")?J.test(b.get().parseXML(e)):!1},parse(e){return J.parse(b.get().parseXML(e))}},$e=[".xml",".fnt"],Ge={extension:f.CacheParser,test:e=>e instanceof ie,getCacheableAssets(e,t){const s={};return e.forEach(i=>{s[i]=t}),s[`${t.fontFamily}-bitmap`]=t,s}},De={extension:{type:f.LoadParser,priority:v.Normal},test(e){return $e.includes(_.extname(e).toLowerCase())},async testParse(e){return W.test(e)||Y.test(e)},async parse(e,t,s){const i=W.test(e)?W.parse(e):Y.parse(e),{src:r}=t,{pages:a}=i,o=[];for(let h=0;h<a.length;++h){const d=a[h].file;let u=_.join(_.dirname(r),d);u=V(u,r),o.push(u)}const n=await s.load(o),c=o.map(h=>n[h]);return new ie({data:i,textures:c})},async load(e,t){return await(await b.get().fetch(e)).text()},unload(e){e.destroy()}};function B(e,t){if(Array.isArray(t)){for(const s of t)if(e.startsWith(`data:${s}`))return!0;return!1}return e.startsWith(`data:${t}`)}function k(e,t){const s=e.split("?")[0],i=_.extname(s).toLowerCase();return Array.isArray(t)?t.includes(i):i===t}const Xe=".json",Qe="application/json",Ze={extension:{type:f.LoadParser,priority:v.Low},name:"loadJson",test(e){return B(e,Qe)||k(e,Xe)},async load(e){return await(await b.get().fetch(e)).json()}},Ke=".txt",Je="text/plain",Ye={name:"loadTxt",extension:{type:f.LoadParser,priority:v.Low},test(e){return B(e,Je)||k(e,Ke)},async load(e){return await(await b.get().fetch(e)).text()}},et=["normal","bold","100","200","300","400","500","600","700","800","900"],tt=[".ttf",".otf",".woff",".woff2"],st=["font/ttf","font/otf","font/woff","font/woff2"],it=/^(--|-?[A-Z_])[0-9A-Z_-]*$/i;function rt(e){const t=_.extname(e),r=_.basename(e,t).replace(/(-|_)/g," ").toLowerCase().split(" ").map(n=>n.charAt(0).toUpperCase()+n.slice(1));let a=r.length>0;for(const n of r)if(!n.match(it)){a=!1;break}let o=r.join(" ");return a||(o=`"${o.replace(/[\\"]/g,"\\$&")}"`),o}const at=/^[0-9A-Za-z%:/?#\[\]@!\$&'()\*\+,;=\-._~]*$/;function nt(e){return at.test(e)?e:encodeURI(e)}const ot={extension:{type:f.LoadParser,priority:v.Low},name:"loadWebFont",test(e){return B(e,st)||k(e,tt)},async load(e,t){const s=b.get().getFontFaceSet();if(s){const i=[],r=t.data?.family??rt(e),a=t.data?.weights?.filter(n=>et.includes(n))??["normal"],o=t.data??{};for(let n=0;n<a.length;n++){const c=a[n],l=new FontFace(r,`url(${nt(e)})`,{...o,weight:c});await l.load(),s.add(l),i.push(l)}return U.set(r,{url:e,fontFaces:i}),i.length===1?i[0]:i}return w("[loadWebFont] FontFace API is not supported. Skipping loading font"),null},unload(e){(Array.isArray(e)?e:[e]).forEach(t=>{U.remove(t.family),b.get().getFontFaceSet().delete(t)})}},lt=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m,ct=".svg",ht="image/svg+xml",dt={extension:{type:f.LoadParser,priority:v.Low},name:"loadSVG",test(e){return B(e,ht)||k(e,ct)},async testParse(e){return typeof e=="string"&&e.startsWith("data:image/svg+xml")||typeof e=="string"&&lt.test(e)},async parse(e){const t=new Ie;return t.svg(e),t},async load(e){return(await b.get().fetch(e)).text()},unload(e){e.destroy(!0)}};function he(e,t=1){const s=O.RETINA_PREFIX?.exec(e);return s?parseFloat(s[1]):t}let ee=0,z;const ut="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=",ft={id:"checkImageBitmap",code:`
    async function checkImageBitmap()
    {
        try
        {
            if (typeof createImageBitmap !== 'function') return false;

            const response = await fetch('${ut}');
            const imageBlob =  await response.blob();
            const imageBitmap = await createImageBitmap(imageBlob);

            return imageBitmap.width === 1 && imageBitmap.height === 1;
        }
        catch (e)
        {
            return false;
        }
    }
    checkImageBitmap().then((result) => { self.postMessage(result); });
    `},At={id:"loadImageBitmap",code:`
    async function loadImageBitmap(url)
    {
        const response = await fetch(url);

        if (!response.ok)
        {
            throw new Error(\`[WorkerManager.loadImageBitmap] Failed to fetch \${url}: \`
                + \`\${response.status} \${response.statusText}\`);
        }

        const imageBlob =  await response.blob();
        const imageBitmap = await createImageBitmap(imageBlob);

        return imageBitmap;
    }
    self.onmessage = async (event) =>
    {
        try
        {
            const imageBitmap = await loadImageBitmap(event.data.data[0]);

            self.postMessage({
                data: imageBitmap,
                uuid: event.data.uuid,
                id: event.data.id,
            }, [imageBitmap]);
        }
        catch(e)
        {
            self.postMessage({
                error: e,
                uuid: event.data.uuid,
                id: event.data.id,
            });
        }
    };`};let H;class mt{constructor(){this._initialized=!1,this._createdWorkers=0,this._workerPool=[],this._queue=[],this._resolveHash={}}isImageBitmapSupported(){return this._isImageBitmapSupported!==void 0?this._isImageBitmapSupported:(this._isImageBitmapSupported=new Promise(t=>{const s=URL.createObjectURL(new Blob([ft.code],{type:"application/javascript"})),i=new Worker(s);i.addEventListener("message",r=>{i.terminate(),URL.revokeObjectURL(s),t(r.data)})}),this._isImageBitmapSupported)}loadImageBitmap(t){return this._run("loadImageBitmap",[t])}async _initWorkers(){this._initialized||(this._initialized=!0)}_getWorker(){z===void 0&&(z=navigator.hardwareConcurrency||4);let t=this._workerPool.pop();return!t&&this._createdWorkers<z&&(H||(H=URL.createObjectURL(new Blob([At.code],{type:"application/javascript"}))),this._createdWorkers++,t=new Worker(H),t.addEventListener("message",s=>{this._complete(s.data),this._returnWorker(s.target),this._next()})),t}_returnWorker(t){this._workerPool.push(t)}_complete(t){t.error!==void 0?this._resolveHash[t.uuid].reject(t.error):this._resolveHash[t.uuid].resolve(t.data),this._resolveHash[t.uuid]=null}async _run(t,s){await this._initWorkers();const i=new Promise((r,a)=>{this._queue.push({id:t,arguments:s,resolve:r,reject:a})});return this._next(),i}_next(){if(!this._queue.length)return;const t=this._getWorker();if(!t)return;const s=this._queue.pop(),i=s.id;this._resolveHash[ee]={resolve:s.resolve,reject:s.reject},t.postMessage({data:s.arguments,uuid:ee++,id:i})}}const te=new mt;function de(e,t,s){e.label=s;const i=new R({source:e,label:s}),r=()=>{delete t.promiseCache[s],U.has(s)&&U.remove(s)};return i.once("destroy",()=>{s in t.promiseCache&&(w("[Assets] A BaseTexture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the BaseTexture."),r())}),i.source.once("destroy",()=>{e.destroyed||(w("[Assets] A Texture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the Texture."),r())}),i}const pt=[".jpeg",".jpg",".png",".webp",".avif"],gt=["image/jpeg","image/png","image/webp","image/avif"];async function _t(e){const t=await b.get().fetch(e);if(!t.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${e}: ${t.status} ${t.statusText}`);const s=await t.blob();return await createImageBitmap(s)}const ue={name:"loadTextures",extension:{type:f.LoadParser,priority:v.High},config:{preferWorkers:!0,preferCreateImageBitmap:!0,crossOrigin:"anonymous"},test(e){return B(e,gt)||k(e,pt)},async load(e,t,s){let i=null;globalThis.createImageBitmap&&this.config.preferCreateImageBitmap?this.config.preferWorkers&&await te.isImageBitmapSupported()?i=await te.loadImageBitmap(e):i=await _t(e):i=await new Promise(a=>{i=new Image,i.crossOrigin=this.config.crossOrigin,i.src=e,i.complete?a(i):i.onload=()=>{a(i)}});const r=new re({resource:i,alphaMode:"premultiply-alpha-on-upload",resolution:t.data?.resolution||he(e),...t.data});return de(r,s,e)},unload(e){e.destroy(!0)}};let j;async function fe(){return j??(j=(async()=>{const t=document.createElement("canvas").getContext("webgl");if(!t)return"premultiply-alpha-on-upload";const s=await new Promise(o=>{const n=document.createElement("video");n.onloadeddata=()=>o(n),n.onerror=()=>o(null),n.autoplay=!1,n.crossOrigin="anonymous",n.preload="auto",n.src="data:video/webm;base64,GkXfo59ChoEBQveBAULygQRC84EIQoKEd2VibUKHgQJChYECGFOAZwEAAAAAAAHTEU2bdLpNu4tTq4QVSalmU6yBoU27i1OrhBZUrmtTrIHGTbuMU6uEElTDZ1OsggEXTbuMU6uEHFO7a1OsggG97AEAAAAAAABZAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmoCrXsYMPQkBNgIRMYXZmV0GETGF2ZkSJiEBEAAAAAAAAFlSua8yuAQAAAAAAAEPXgQFzxYgAAAAAAAAAAZyBACK1nIN1bmSIgQCGhVZfVlA5g4EBI+ODhAJiWgDglLCBArqBApqBAlPAgQFVsIRVuYEBElTDZ9Vzc9JjwItjxYgAAAAAAAAAAWfInEWjh0VOQ09ERVJEh49MYXZjIGxpYnZweC12cDlnyKJFo4hEVVJBVElPTkSHlDAwOjAwOjAwLjA0MDAwMDAwMAAAH0O2dcfngQCgwqGggQAAAIJJg0IAABAAFgA4JBwYSgAAICAAEb///4r+AAB1oZ2mm+6BAaWWgkmDQgAAEAAWADgkHBhKAAAgIABIQBxTu2uRu4+zgQC3iveBAfGCAXHwgQM=",n.load()});if(!s)return"premultiply-alpha-on-upload";const i=t.createTexture();t.bindTexture(t.TEXTURE_2D,i);const r=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,r),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,i,0),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,t.NONE),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,s);const a=new Uint8Array(4);return t.readPixels(0,0,1,1,t.RGBA,t.UNSIGNED_BYTE,a),t.deleteFramebuffer(r),t.deleteTexture(i),t.getExtension("WEBGL_lose_context")?.loseContext(),a[0]<=a[3]?"premultiplied-alpha":"premultiply-alpha-on-upload"})()),j}const Ae=class extends ${constructor(e){super(e),this.isReady=!1,this.uploadMethodId="video",e={...Ae.defaultOptions,...e},this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=e.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=e.autoPlay!==!1,this.alphaMode=e.alphaMode??"premultiply-alpha-on-upload",this._videoFrameRequestCallback=this._videoFrameRequestCallback.bind(this),this._videoFrameRequestCallbackHandle=null,this._load=null,this._resolve=null,this._reject=null,this._onCanPlay=this._onCanPlay.bind(this),this._onCanPlayThrough=this._onCanPlayThrough.bind(this),this._onError=this._onError.bind(this),this._onPlayStart=this._onPlayStart.bind(this),this._onPlayStop=this._onPlayStop.bind(this),this._onSeeked=this._onSeeked.bind(this),e.autoLoad!==!1&&this.load()}updateFrame(){if(!this.destroyed){if(this._updateFPS){const e=S.shared.elapsedMS*this.resource.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-e)}(!this._updateFPS||this._msToNextUpdate<=0)&&(this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0),this.isValid&&this.update()}}_videoFrameRequestCallback(){this.updateFrame(),this.destroyed?this._videoFrameRequestCallbackHandle=null:this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback)}get isValid(){return!!this.resource.videoWidth&&!!this.resource.videoHeight}async load(){if(this._load)return this._load;const e=this.resource,t=this.options;return(e.readyState===e.HAVE_ENOUGH_DATA||e.readyState===e.HAVE_FUTURE_DATA)&&e.width&&e.height&&(e.complete=!0),e.addEventListener("play",this._onPlayStart),e.addEventListener("pause",this._onPlayStop),e.addEventListener("seeked",this._onSeeked),this._isSourceReady()?this._mediaReady():(t.preload||e.addEventListener("canplay",this._onCanPlay),e.addEventListener("canplaythrough",this._onCanPlayThrough),e.addEventListener("error",this._onError,!0)),this.alphaMode=await fe(),this._load=new Promise((s,i)=>{this.isValid?s(this):(this._resolve=s,this._reject=i,t.preloadTimeoutMs!==void 0&&(this._preloadTimeout=setTimeout(()=>{this._onError(new ErrorEvent(`Preload exceeded timeout of ${t.preloadTimeoutMs}ms`))})),e.load())}),this._load}_onError(e){this.resource.removeEventListener("error",this._onError,!0),this.emit("error",e),this._reject&&(this._reject(e),this._reject=null,this._resolve=null)}_isSourcePlaying(){const e=this.resource;return!e.paused&&!e.ended}_isSourceReady(){return this.resource.readyState>2}_onPlayStart(){this.isValid||this._mediaReady(),this._configureAutoUpdate()}_onPlayStop(){this._configureAutoUpdate()}_onSeeked(){this._autoUpdate&&!this._isSourcePlaying()&&(this._msToNextUpdate=0,this.updateFrame(),this._msToNextUpdate=0)}_onCanPlay(){this.resource.removeEventListener("canplay",this._onCanPlay),this._mediaReady()}_onCanPlayThrough(){this.resource.removeEventListener("canplaythrough",this._onCanPlay),this._preloadTimeout&&(clearTimeout(this._preloadTimeout),this._preloadTimeout=void 0),this._mediaReady()}_mediaReady(){const e=this.resource;this.isValid&&(this.isReady=!0,this.resize(e.videoWidth,e.videoHeight)),this._msToNextUpdate=0,this.updateFrame(),this._msToNextUpdate=0,this._resolve&&(this._resolve(this),this._resolve=null,this._reject=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&this.resource.play()}destroy(){this._configureAutoUpdate();const e=this.resource;e&&(e.removeEventListener("play",this._onPlayStart),e.removeEventListener("pause",this._onPlayStop),e.removeEventListener("seeked",this._onSeeked),e.removeEventListener("canplay",this._onCanPlay),e.removeEventListener("canplaythrough",this._onCanPlayThrough),e.removeEventListener("error",this._onError,!0),e.pause(),e.src="",e.load()),super.destroy()}get autoUpdate(){return this._autoUpdate}set autoUpdate(e){e!==this._autoUpdate&&(this._autoUpdate=e,this._configureAutoUpdate())}get updateFPS(){return this._updateFPS}set updateFPS(e){e!==this._updateFPS&&(this._updateFPS=e,this._configureAutoUpdate())}_configureAutoUpdate(){this._autoUpdate&&this._isSourcePlaying()?!this._updateFPS&&this.source.requestVideoFrameCallback?(this._isConnectedToTicker&&(S.shared.remove(this.updateFrame,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0),this._videoFrameRequestCallbackHandle===null&&(this._videoFrameRequestCallbackHandle=this.source.requestVideoFrameCallback(this._videoFrameRequestCallback))):(this._videoFrameRequestCallbackHandle!==null&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker||(S.shared.add(this.updateFrame,this),this._isConnectedToTicker=!0,this._msToNextUpdate=0)):(this._videoFrameRequestCallbackHandle!==null&&(this.source.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker&&(S.shared.remove(this.updateFrame,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0))}static test(e){return globalThis.HTMLVideoElement&&e instanceof HTMLVideoElement||globalThis.VideoFrame&&e instanceof VideoFrame}};let E=Ae;E.extension=f.TextureSource;E.defaultOptions={...$.defaultOptions,autoLoad:!0,autoPlay:!0,updateFPS:0,crossorigin:!0,loop:!1,muted:!0,playsinline:!0,preload:!1};E.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};const me=[".mp4",".m4v",".webm",".ogg",".ogv",".h264",".avi",".mov"],yt=me.map(e=>`video/${e.substring(1)}`);function bt(e,t,s){s===void 0&&!t.startsWith("data:")?e.crossOrigin=vt(t):s!==!1&&(e.crossOrigin=typeof s=="string"?s:"anonymous")}function xt(e){return new Promise((t,s)=>{e.addEventListener("canplaythrough",i),e.addEventListener("error",r),e.load();function i(){a(),t()}function r(o){a(),s(o)}function a(){e.removeEventListener("canplaythrough",i),e.removeEventListener("error",r)}})}function vt(e,t=globalThis.location){if(e.startsWith("data:"))return"";t=t||globalThis.location;const s=new URL(e,document.baseURI);return s.hostname!==t.hostname||s.port!==t.port||s.protocol!==t.protocol?"anonymous":""}const St={name:"loadVideo",extension:{type:f.LoadParser},config:null,test(e){const t=B(e,yt),s=k(e,me);return t||s},async load(e,t,s){const i={...E.defaultOptions,resolution:t.data?.resolution||he(e),alphaMode:t.data?.alphaMode||await fe(),...t.data},r=document.createElement("video"),a={preload:i.autoLoad!==!1?"auto":void 0,"webkit-playsinline":i.playsinline!==!1?"":void 0,playsinline:i.playsinline!==!1?"":void 0,muted:i.muted===!0?"":void 0,loop:i.loop===!0?"":void 0,autoplay:i.autoPlay!==!1?"":void 0};Object.keys(a).forEach(l=>{const h=a[l];h!==void 0&&r.setAttribute(l,h)}),i.muted===!0&&(r.muted=!0),bt(r,e,i.crossorigin);const o=document.createElement("source");let n;if(e.startsWith("data:"))n=e.slice(5,e.indexOf(";"));else if(!e.startsWith("blob:")){const l=e.split("?")[0].slice(e.lastIndexOf(".")+1).toLowerCase();n=E.MIME_TYPES[l]||`video/${l}`}o.src=e,n&&(o.type=n),r.appendChild(o);const c=new E({...i,resource:r});return t.data.preload&&await xt(r),de(c,s,e)},unload(e){e.destroy(!0)}},Et={extension:f.ResolveParser,test:ue.test,parse:e=>({resolution:parseFloat(O.RETINA_PREFIX.exec(e)?.[1]??"1"),format:e.split(".").pop(),src:e})};x.add(Oe,We,Ne,qe,He,je,Ve,Ze,Ye,ot,dt,ue,St,Et,De,Ge);const se={loader:f.LoadParser,resolver:f.ResolveParser,cache:f.CacheParser,detection:f.DetectionParser};x.handle(f.Asset,e=>{const t=e.ref;Object.entries(se).filter(([s])=>!!t[s]).forEach(([s,i])=>x.add(Object.assign(t[s],{extension:t[s].extension??i})))},e=>{const t=e.ref;Object.keys(se).filter(s=>!!t[s]).forEach(s=>x.remove(t[s]))});const F=class{constructor(e,t){this.linkedSheets=[],this._texture=e instanceof R?e:null,this.textureSource=e.source,this.textures={},this.animations={},this.data=t;const s=parseFloat(t.meta.scale);s?(this.resolution=s,e.source.resolution=this.resolution):this.resolution=e.source._resolution,this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}parse(){return new Promise(e=>{this._callback=e,this._batchIndex=0,this._frameKeys.length<=F.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()})}_processFrames(e){let t=e;const s=F.BATCH_SIZE;for(;t-e<s&&t<this._frameKeys.length;){const i=this._frameKeys[t],r=this._frames[i],a=r.frame;if(a){let o=null,n=null;const c=r.trimmed!==!1&&r.sourceSize?r.sourceSize:r.frame,l=new C(0,0,Math.floor(c.w)/this.resolution,Math.floor(c.h)/this.resolution);r.rotated?o=new C(Math.floor(a.x)/this.resolution,Math.floor(a.y)/this.resolution,Math.floor(a.h)/this.resolution,Math.floor(a.w)/this.resolution):o=new C(Math.floor(a.x)/this.resolution,Math.floor(a.y)/this.resolution,Math.floor(a.w)/this.resolution,Math.floor(a.h)/this.resolution),r.trimmed!==!1&&r.spriteSourceSize&&(n=new C(Math.floor(r.spriteSourceSize.x)/this.resolution,Math.floor(r.spriteSourceSize.y)/this.resolution,Math.floor(a.w)/this.resolution,Math.floor(a.h)/this.resolution),n.x/=this.textureSource.width,n.y/=this.textureSource.height,n.width/=this.textureSource.width,n.height/=this.textureSource.height),o.x/=this.textureSource.width,o.y/=this.textureSource.height,o.width/=this.textureSource.width,o.height/=this.textureSource.height,l.x/=this.textureSource.width,l.y/=this.textureSource.height,l.width/=this.textureSource.width,l.height/=this.textureSource.height,this.textures[i]=new R({source:this.textureSource,layout:{frame:o,orig:l,trim:n,rotate:r.rotated?2:0,defaultAnchor:r.anchor,defaultBorders:r.borders},label:i.toString()})}t++}}_processAnimations(){const e=this.data.animations||{};for(const t in e){this.animations[t]=[];for(let s=0;s<e[t].length;s++){const i=e[t][s];this.animations[t].push(this.textures[i])}}}_parseComplete(){const e=this._callback;this._callback=null,this._batchIndex=0,e.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*F.BATCH_SIZE),this._batchIndex++,setTimeout(()=>{this._batchIndex*F.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())},0)}destroy(e=!1){for(const t in this.textures)this.textures[t].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,e&&(this._texture?.destroy(),this.textureSource.destroy()),this._texture=null,this.textureSource=null,this.linkedSheets=[]}};let q=F;q.BATCH_SIZE=1e3;const It=["jpg","png","jpeg","avif","webp"];function pe(e,t,s){const i={};if(e.forEach(r=>{i[r]=t}),Object.keys(t.textures).forEach(r=>{i[r]=t.textures[r]}),!s){const r=_.dirname(e[0]);t.linkedSheets.forEach((a,o)=>{const n=pe([`${r}/${t.data.meta.related_multi_packs[o]}`],a,!0);Object.assign(i,n)})}return i}const wt={extension:f.Asset,cache:{test:e=>e instanceof q,getCacheableAssets:(e,t)=>pe(e,t,!1)},resolver:{test:e=>{const s=e.split("?")[0].split("."),i=s.pop(),r=s.pop();return i==="json"&&It.includes(r)},parse:e=>{const t=e.split(".");return{resolution:parseFloat(O.RETINA_PREFIX.exec(e)?.[1]??"1"),format:t[t.length-2],src:e}}},loader:{name:"spritesheetLoader",extension:{type:f.LoadParser,priority:v.Normal},async testParse(e,t){return _.extname(t.src).toLowerCase()===".json"&&!!e.frames},async parse(e,t,s){let i=_.dirname(t.src);i&&i.lastIndexOf("/")!==i.length-1&&(i+="/");let r=i+e.meta.image;r=V(r,t.src);const o=(await s.load([r]))[r],n=new q(o.source,e);await n.parse();const c=e?.meta?.related_multi_packs;if(Array.isArray(c)){const l=[];for(const d of c){if(typeof d!="string")continue;let u=i+d;t.data?.ignoreMultiPack||(u=V(u,t.src),l.push(s.load({src:u,data:{ignoreMultiPack:!0}})))}const h=await Promise.all(l);n.linkedSheets=h,h.forEach(d=>{d.linkedSheets=[n].concat(n.linkedSheets.filter(u=>u!==d))})}return n},unload(e){e.destroy(!0)}}};x.add(wt);const Bt=new ae;function ge(e,t,s){const i=Bt;e.measurable=!0,we(e,s,i),t.addBoundsMask(i),e.measurable=!1}function _e(e,t,s){const i=new ae;e.measurable=!0;const r=ye(e,s,new Te);Be(e,i,r),e.measurable=!1,t.addBoundsMask(i)}function ye(e,t,s){return e?(e!==t&&(ye(e.parent,t,s),e.didChange&&ke(e.localTransform,e),s.append(e.localTransform)),s):(w("Item is not inside the root container"),s)}class be{constructor(t){this.priority=0,this.pipe="alphaMask",t?.mask&&this.init(t.mask)}init(t){this.mask=t,this.renderMaskToTexture=!(t instanceof Q),this.mask.renderable=this.renderMaskToTexture,this.mask.includeInBuild=!this.renderMaskToTexture,this.mask.measurable=!1}reset(){this.mask.measurable=!0,this.mask=null}addBounds(t,s){ge(this.mask,t,s)}addLocalBounds(t,s){_e(this.mask,t,s)}containsPoint(t,s){const i=this.mask;return s(i,t)}destroy(){this.reset()}static test(t){return t instanceof Q}}be.extension=f.MaskEffect;class xe{constructor(t){this.priority=0,this.pipe="colorMask",t?.mask&&this.init(t.mask)}init(t){this.mask=t}destroy(){}static test(t){return typeof t=="number"}}xe.extension=f.MaskEffect;class ve{constructor(t){this.priority=0,this.pipe="stencilMask",t?.mask&&this.init(t.mask)}init(t){this.mask=t,this.mask.includeInBuild=!1,this.mask.measurable=!1}reset(){this.mask.measurable=!0,this.mask.includeInBuild=!0,this.mask=null}addBounds(t,s){ge(this.mask,t,s)}addLocalBounds(t,s){_e(this.mask,t,s)}containsPoint(t,s){const i=this.mask;return s(i,t)}destroy(){this.reset()}static test(t){return t instanceof Pe}}ve.extension=f.MaskEffect;class Se extends ${constructor(t){const s=t.resource||new Float32Array(t.width*t.height*4);let i=t.format;i||(s instanceof Float32Array?i="rgba32float":s instanceof Int32Array||s instanceof Uint32Array?i="rgba32uint":s instanceof Int16Array||s instanceof Uint16Array?i="rgba16uint":(s instanceof Int8Array,i="bgra8unorm")),super({...t,resource:s,format:i}),this.uploadMethodId="buffer"}static test(t){return t instanceof Int8Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Int16Array||t instanceof Uint16Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array}}Se.extension=f.TextureSource;x.add(be,xe,ve,E,re,Fe,Se);export{S as T,L as U};
